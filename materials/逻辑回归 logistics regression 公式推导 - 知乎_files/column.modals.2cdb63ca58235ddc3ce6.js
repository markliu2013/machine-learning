(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{2107:function(e,t,n){e.exports=n(2191)()},2132:function(e,t,n){"use strict";var a=r(n(2190)),o=r(n(2133));function r(e){return e&&e.__esModule?e:{default:e}}e.exports={TransitionGroup:o.default,CSSTransitionGroup:a.default}},2133:function(e,t,n){"use strict";t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=c(n(2193)),r=c(n(0)),i=c(n(2107)),s=(c(n(2194)),n(2195));function c(e){return e&&e.__esModule?e:{default:e}}i.default.any,i.default.func,i.default.node;var l=function(e){function t(n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n,o));return r.performAppear=function(e,t){r.currentlyTransitioningKeys[e]=!0,t.componentWillAppear?t.componentWillAppear(r._handleDoneAppearing.bind(r,e,t)):r._handleDoneAppearing(e,t)},r._handleDoneAppearing=function(e,t){t.componentDidAppear&&t.componentDidAppear(),delete r.currentlyTransitioningKeys[e];var n=(0,s.getChildMapping)(r.props.children);n&&n.hasOwnProperty(e)||r.performLeave(e,t)},r.performEnter=function(e,t){r.currentlyTransitioningKeys[e]=!0,t.componentWillEnter?t.componentWillEnter(r._handleDoneEntering.bind(r,e,t)):r._handleDoneEntering(e,t)},r._handleDoneEntering=function(e,t){t.componentDidEnter&&t.componentDidEnter(),delete r.currentlyTransitioningKeys[e];var n=(0,s.getChildMapping)(r.props.children);n&&n.hasOwnProperty(e)||r.performLeave(e,t)},r.performLeave=function(e,t){r.currentlyTransitioningKeys[e]=!0,t.componentWillLeave?t.componentWillLeave(r._handleDoneLeaving.bind(r,e,t)):r._handleDoneLeaving(e,t)},r._handleDoneLeaving=function(e,t){t.componentDidLeave&&t.componentDidLeave(),delete r.currentlyTransitioningKeys[e];var n=(0,s.getChildMapping)(r.props.children);n&&n.hasOwnProperty(e)?r.keysToEnter.push(e):r.setState(function(t){var n=a({},t.children);return delete n[e],{children:n}})},r.childRefs=Object.create(null),r.state={children:(0,s.getChildMapping)(n.children)},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillMount=function(){this.currentlyTransitioningKeys={},this.keysToEnter=[],this.keysToLeave=[]},t.prototype.componentDidMount=function(){var e=this.state.children;for(var t in e)e[t]&&this.performAppear(t,this.childRefs[t])},t.prototype.componentWillReceiveProps=function(e){var t=(0,s.getChildMapping)(e.children),n=this.state.children;for(var a in this.setState({children:(0,s.mergeChildMappings)(n,t)}),t){var o=n&&n.hasOwnProperty(a);!t[a]||o||this.currentlyTransitioningKeys[a]||this.keysToEnter.push(a)}for(var r in n){var i=t&&t.hasOwnProperty(r);!n[r]||i||this.currentlyTransitioningKeys[r]||this.keysToLeave.push(r)}},t.prototype.componentDidUpdate=function(){var e=this,t=this.keysToEnter;this.keysToEnter=[],t.forEach(function(t){return e.performEnter(t,e.childRefs[t])});var n=this.keysToLeave;this.keysToLeave=[],n.forEach(function(t){return e.performLeave(t,e.childRefs[t])})},t.prototype.render=function(){var e=this,t=[],n=function(n){var a=e.state.children[n];if(a){var i="string"!=typeof a.ref,s=e.props.childFactory(a),c=function(t){e.childRefs[n]=t};s===a&&i&&(c=(0,o.default)(a.ref,c)),t.push(r.default.cloneElement(s,{key:n,ref:c}))}};for(var i in this.state.children)n(i);var s=a({},this.props);return delete s.transitionLeave,delete s.transitionName,delete s.transitionAppear,delete s.transitionEnter,delete s.childFactory,delete s.transitionLeaveTimeout,delete s.transitionEnterTimeout,delete s.transitionAppearTimeout,delete s.component,r.default.createElement(this.props.component,s,t)},t}(r.default.Component);l.displayName="TransitionGroup",l.propTypes={},l.defaultProps={component:"span",childFactory:function(e){return e}},t.default=l,e.exports=t.default},2134:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=!("undefined"==typeof window||!window.document||!window.document.createElement),e.exports=t.default},2135:function(e,t,n){"use strict";t.__esModule=!0,t.nameShape=void 0,t.transitionTimeout=function(e){var t="transition"+e+"Timeout",n="transition"+e;return function(e){if(e[n]){if(null==e[t])return new Error(t+" wasn't supplied to CSSTransitionGroup: this can cause unreliable animations and won't be supported in a future version of React. See https://fb.me/react-animation-transition-group-timeout for more information.");if("number"!=typeof e[t])return new Error(t+" must be a number (in milliseconds)")}return null}};o(n(0));var a=o(n(2107));function o(e){return e&&e.__esModule?e:{default:e}}t.nameShape=a.default.oneOfType([a.default.string,a.default.shape({enter:a.default.string,leave:a.default.string,active:a.default.string}),a.default.shape({enter:a.default.string,enterActive:a.default.string,leave:a.default.string,leaveActive:a.default.string,appear:a.default.string,appearActive:a.default.string})])},2136:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var a=n(3),o=n(2),r=n(6),i=n(4),s=n(5),c=n(0),l=n.n(c),m=n(91),u=(n(2203),function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.onRef;return l.a.createElement("div",{className:"Comments-pattern-loading",ref:e},l.a.createElement(m.a,null))}}]),t}(c.PureComponent))},2137:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var a=n(7);function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.selectedKey,r=void 0===o?"selectedProps":o,i=n.dropedKey,s=void 0===i?"dropedProps":i;return Object.keys(e).reduce(function(n,o){var i=t.includes(o)?r:s;return Object.assign({},n,Object(a.a)({},i,Object.assign({},n[i],Object(a.a)({},o,e[o]))))},{})}},2138:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a=function(e){return"article"===e?"Post":"book_review"===e?"BookReview":"".concat(e.slice(0,1).toUpperCase()).concat(e.slice(1))}},2172:function(e,t,n){"use strict";var a=n(3),o=n(2),r=n(6),i=n(4),s=n(5),c=n(10),l=n(0),m=n.n(l),u=n(8),d=n.n(u),p=n(9),h=function(e){function t(){var e,n;Object(a.a)(this,t);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return(n=Object(r.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).handleClick=function(){var e=n.props;(0,e.onSelect)(e.page)},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,a=e.className;return m.a.createElement(p.c,{preset:p.b.Plain,className:d()("PaginationButton",{"PaginationButton--current":n},a),onClick:this.handleClick,disabled:n},t)}}]),t}(l.Component),f=(n(2202),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.from({length:t},function(t,n){return n+e})}),v=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.onSelect,a=t.className,o=t.clickCallback,r=this.props.current,i=this.props.total,s=o&&(e=o,function(){e.apply(void 0,arguments)})||n,l=function(e,t){var n="...";return t<=5?f(1,t):e>t-3?[1,n].concat(Object(c.a)(f(t-3,3)),[t]):e<=3?[1].concat(Object(c.a)(f(2,3)),[n,t]):[1,n].concat(Object(c.a)(f(e-Math.floor(1.5),3)),[n,t])}(r,i);return m.a.createElement("div",{className:d()("Pagination",a)},r>1&&r<=i&&m.a.createElement(h,{className:"PaginationButton-prev",onSelect:s,text:"上一页",page:r-1}),l.map(function(e,t){return"number"==typeof e?m.a.createElement(h,{onSelect:s,text:e,page:e,key:t,isCurrent:r===e}):m.a.createElement("button",{disabled:!0,key:t,className:"PaginationButton PaginationButton--ellipsis"},e)}),r>0&&r<i&&m.a.createElement(h,{className:"PaginationButton-next",onSelect:s,text:"下一页",page:r+1}))}}]),t}(l.Component);v.defaultProps={current:1,total:1,onSelect:function(){}},n.d(t,"a",function(){return v})},2190:function(e,t,n){"use strict";t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=l(n(0)),r=l(n(2107)),i=l(n(2133)),s=l(n(2196)),c=n(2135);function l(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}c.nameShape.isRequired,r.default.bool,r.default.bool,r.default.bool,(0,c.transitionTimeout)("Appear"),(0,c.transitionTimeout)("Enter"),(0,c.transitionTimeout)("Leave");var u=function(e){function t(){var n,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=Array(r),c=0;c<r;c++)i[c]=arguments[c];return n=a=m(this,e.call.apply(e,[this].concat(i))),a._wrapChild=function(e){return o.default.createElement(s.default,{name:a.props.transitionName,appear:a.props.transitionAppear,enter:a.props.transitionEnter,leave:a.props.transitionLeave,appearTimeout:a.props.transitionAppearTimeout,enterTimeout:a.props.transitionEnterTimeout,leaveTimeout:a.props.transitionLeaveTimeout},e)},m(a,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){return o.default.createElement(i.default,a({},this.props,{childFactory:this._wrapChild}))},t}(o.default.Component);u.displayName="CSSTransitionGroup",u.propTypes={},u.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},t.default=u,e.exports=t.default},2191:function(e,t,n){"use strict";var a=n(511),o=n(392),r=n(2192);e.exports=function(){function e(e,t,n,a,i,s){s!==r&&o(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=a,n.PropTypes=n,n}},2192:function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},2193:function(e,t){e.exports=function(){for(var e=arguments.length,t=[],n=0;n<e;n++)t[n]=arguments[n];if(0!==(t=t.filter(function(e){return null!=e})).length)return 1===t.length?t[0]:t.reduce(function(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}})}},2194:function(e,t,n){e.exports=n(57)(21)},2195:function(e,t,n){"use strict";t.__esModule=!0,t.getChildMapping=function(e){if(!e)return e;var t={};return a.Children.map(e,function(e){return e}).forEach(function(e){t[e.key]=e}),t},t.mergeChildMappings=function(e,t){function n(n){return t.hasOwnProperty(n)?t[n]:e[n]}e=e||{},t=t||{};var a={},o=[];for(var r in e)t.hasOwnProperty(r)?o.length&&(a[r]=o,o=[]):o.push(r);var i=void 0,s={};for(var c in t){if(a.hasOwnProperty(c))for(i=0;i<a[c].length;i++){var l=a[c][i];s[a[c][i]]=n(l)}s[c]=n(c)}for(i=0;i<o.length;i++)s[o[i]]=n(o[i]);return s};var a=n(0)},2196:function(e,t,n){"use strict";t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=d(n(2197)),r=d(n(2199)),i=d(n(2200)),s=n(2201),c=d(n(0)),l=d(n(2107)),m=n(32),u=n(2135);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=[];s.transitionEnd&&h.push(s.transitionEnd),s.animationEnd&&h.push(s.animationEnd);l.default.node,u.nameShape.isRequired,l.default.bool,l.default.bool,l.default.bool,l.default.number,l.default.number,l.default.number;var f=function(e){function t(){var n,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=Array(o),i=0;i<o;i++)r[i]=arguments[i];return n=a=p(this,e.call.apply(e,[this].concat(r))),a.componentWillAppear=function(e){a.props.appear?a.transition("appear",e,a.props.appearTimeout):e()},a.componentWillEnter=function(e){a.props.enter?a.transition("enter",e,a.props.enterTimeout):e()},a.componentWillLeave=function(e){a.props.leave?a.transition("leave",e,a.props.leaveTimeout):e()},p(a,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillMount=function(){this.classNameAndNodeQueue=[],this.transitionTimeouts=[]},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.timeout&&clearTimeout(this.timeout),this.transitionTimeouts.forEach(function(e){clearTimeout(e)}),this.classNameAndNodeQueue.length=0},t.prototype.transition=function(e,t,n){var a=(0,m.findDOMNode)(this);if(a){var i=this.props.name[e]||this.props.name+"-"+e,c=this.props.name[e+"Active"]||i+"-active",l=null,u=void 0;(0,o.default)(a,i),this.queueClassAndNode(c,a);var d=function(e){e&&e.target!==a||(clearTimeout(l),u&&u(),(0,r.default)(a,i),(0,r.default)(a,c),u&&u(),t&&t())};n?(l=setTimeout(d,n),this.transitionTimeouts.push(l)):s.transitionEnd&&(u=function(e,t){return h.length?h.forEach(function(n){return e.addEventListener(n,t,!1)}):setTimeout(t,0),function(){h.length&&h.forEach(function(n){return e.removeEventListener(n,t,!1)})}}(a,d))}else t&&t()},t.prototype.queueClassAndNode=function(e,t){var n=this;this.classNameAndNodeQueue.push({className:e,node:t}),this.rafHandle||(this.rafHandle=(0,i.default)(function(){return n.flushClassNameAndNodeQueue()}))},t.prototype.flushClassNameAndNodeQueue=function(){this.unmounted||this.classNameAndNodeQueue.forEach(function(e){e.node.scrollTop,(0,o.default)(e.node,e.className)}),this.classNameAndNodeQueue.length=0,this.rafHandle=null},t.prototype.render=function(){var e=a({},this.props);return delete e.name,delete e.appear,delete e.enter,delete e.leave,delete e.appearTimeout,delete e.enterTimeout,delete e.leaveTimeout,delete e.children,c.default.cloneElement(c.default.Children.only(this.props.children),e)},t}(c.default.Component);f.displayName="CSSTransitionGroupChild",f.propTypes={},t.default=f,e.exports=t.default},2197:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.classList?e.classList.add(t):(0,r.default)(e,t)||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))};var a,o=n(2198),r=(a=o)&&a.__esModule?a:{default:a};e.exports=t.default},2198:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")},e.exports=t.default},2199:function(e,t,n){"use strict";function a(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}e.exports=function(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=a(e.className,t):e.setAttribute("class",a(e.className&&e.className.baseVal||"",t))}},2200:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(2134),r=(a=o)&&a.__esModule?a:{default:a};var i,s="clearTimeout",c=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-m)),a=setTimeout(e,n);return m=t,a},l=function(e,t){return e+(e?t[0].toUpperCase()+t.substr(1):t)+"AnimationFrame"};r.default&&["","webkit","moz","o","ms"].some(function(e){var t=l(e,"request");if(t in window)return s=l(e,"cancel"),c=function(e){return window[t](e)}});var m=(new Date).getTime();(i=function(e){return c(e)}).cancel=function(e){window[s]&&"function"==typeof window[s]&&window[s](e)},t.default=i,e.exports=t.default},2201:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.animationEnd=t.animationDelay=t.animationTiming=t.animationDuration=t.animationName=t.transitionEnd=t.transitionDuration=t.transitionDelay=t.transitionTiming=t.transitionProperty=t.transform=void 0;var a,o=n(2134);var r="transform",i=void 0,s=void 0,c=void 0,l=void 0,m=void 0,u=void 0,d=void 0,p=void 0,h=void 0,f=void 0,v=void 0;if(((a=o)&&a.__esModule?a:{default:a}).default){var b=function(){for(var e=document.createElement("div").style,t={O:function(e){return"o"+e.toLowerCase()},Moz:function(e){return e.toLowerCase()},Webkit:function(e){return"webkit"+e},ms:function(e){return"MS"+e}},n=Object.keys(t),a=void 0,o=void 0,r="",i=0;i<n.length;i++){var s=n[i];if(s+"TransitionProperty"in e){r="-"+s.toLowerCase(),a=t[s]("TransitionEnd"),o=t[s]("AnimationEnd");break}}!a&&"transitionProperty"in e&&(a="transitionend");!o&&"animationName"in e&&(o="animationend");return e=null,{animationEnd:o,transitionEnd:a,prefix:r}}();i=b.prefix,t.transitionEnd=s=b.transitionEnd,t.animationEnd=c=b.animationEnd,t.transform=r=i+"-"+r,t.transitionProperty=l=i+"-transition-property",t.transitionDuration=m=i+"-transition-duration",t.transitionDelay=d=i+"-transition-delay",t.transitionTiming=u=i+"-transition-timing-function",t.animationName=p=i+"-animation-name",t.animationDuration=h=i+"-animation-duration",t.animationTiming=f=i+"-animation-delay",t.animationDelay=v=i+"-animation-timing-function"}t.transform=r,t.transitionProperty=l,t.transitionTiming=u,t.transitionDelay=d,t.transitionDuration=m,t.transitionEnd=s,t.animationName=p,t.animationDuration=h,t.animationTiming=f,t.animationDelay=v,t.animationEnd=c,t.default={transform:r,end:s,property:l,timing:u,delay:d,duration:m}},2202:function(e,t,n){},2203:function(e,t,n){},2204:function(e,t,n){},2205:function(e,t,n){var a=n(855),o=n(279),r=n(394),i=Math.max,s=Math.min;e.exports=function(e,t,n){var c=null==e?0:e.length;if(!c)return-1;var l=c-1;return void 0!==n&&(l=r(n),l=n<0?i(c+l,0):s(l,c-1)),a(e,o(t,3),l,!0)}},2206:function(e,t,n){},2207:function(e,t,n){},2208:function(e,t,n){},2209:function(e,t,n){},2210:function(e,t,n){},2211:function(e,t,n){},2212:function(e,t,n){},2213:function(e,t,n){},2214:function(e,t,n){},2215:function(e,t){e.exports={attributes:{width:"72px",height:"58px",viewBox:"0 0 72 58"},content:'<defs>         <path d="M0.00434937116,11.7604183 C0.0014585125,11.8367351 0,11.9134174 0,11.9904392 L0,52.0095608 C0,55.3137533 2.68603825,58 5.99943435,58 L66.0005656,58 C69.3089213,58 72,55.317989 72,52.0095608 L72,11.9904392 C72,8.68624675 69.3139617,6 66.0005656,6 L31.1520961,6 L30.2346555,3.7077864 C29.4154984,1.66113281 26.9585394,0 24.7478675,0 L6.18638069,0 C2.86742525,0 0.139552484,2.68348852 0.0902454792,5.99373937 L0.00434937116,11.7604183 Z" id="path-1"></path>         <mask id="mask-2" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="72" height="58" fill="white">             <use xlink:href="#path-1"></use>         </mask>     </defs>     <g id="空状态" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">         <g id="collection" transform="translate(-39.000000, -30.000000)" stroke="#E7EAF1">             <g transform="translate(39.000000, 30.000000)" id="Group-7">                 <g>                     <use id="Combined-Shape" mask="url(#mask-2)" stroke-width="6" xlink:href="#path-1"></use>                     <path d="M36.4126782,38.4800003 L30.2669271,41.2927815 C29.7656337,41.522213 29.4096881,41.2718295 29.4738593,40.716584 L30.2498317,34.0024302 L25.6755762,29.0266708 C25.3024658,28.6208107 25.4306014,28.2049135 25.9785012,28.0943637 L32.6038296,26.7575697 L35.9225353,20.8696 C36.1932338,20.3893332 36.6283715,20.3826781 36.9028211,20.8696 L40.2215268,26.7575697 L46.8468552,28.0943637 C47.3872665,28.2034026 47.5280608,28.6151866 47.1497802,29.0266708 L42.5755247,34.0024302 L43.3514971,40.716584 C43.4147912,41.2642406 43.0666691,41.5253922 42.5584293,41.2927815 L36.4126782,38.4800003 Z" id="Star" stroke-width="3"></path>                 </g>             </g>         </g>     </g>'}},2216:function(e,t,n){},2217:function(e,t,n){},2218:function(e,t,n){},2219:function(e,t,n){},2220:function(e,t,n){},2221:function(e,t,n){},2222:function(e,t,n){},2223:function(e,t,n){},2373:function(e,t,n){},2374:function(e,t,n){},2375:function(e,t,n){},2376:function(e,t,n){},2378:function(e,t,n){"use strict";var a=n(0),o=n.n(a),r=n(11),i=function(e){return o.a.createElement(r.a,e,o.a.createElement("path",{d:"M12 11l-3.716 3.782a.758.758 0 0 1-1.064 0 .738.738 0 0 1 0-1.052l4.249-4.512a.758.758 0 0 1 1.064 0l4.246 4.512a.738.738 0 0 1 0 1.052.757.757 0 0 1-1.063 0L12.002 11z",fillRule:"evenodd"}))};i.defaultProps={name:"ArrowUp"},t.a=i},2379:function(e,t,n){"use strict";n.r(t);var a=n(3),o=n(2),r=n(6),i=n(4),s=n(5),c=n(0),l=n.n(c),m=n(8),u=n.n(m),d=n(76),p=n.n(d),h=n(12);n(519);var f=function(e){function t(){var e,n;Object(a.a)(this,t);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return(n=Object(r.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).rootRef=l.a.createRef(),n.unobserve=p.a,n.renderTarget=function(){var e=n.props.item,t=e.content.target,a=t.text,o=t.link,r=e.id,i=e.target,s=e.target,c=(s=void 0===s?{}:s).id,m=s.target,u=void 0===m?{}:m,d=u.type;return i&&"comment"===i.type?n.renderCommentButton(a,{type:d,href:o,byComment:c,target:u,notificationId:r}):l.a.createElement("span",null,o?l.a.createElement("a",{href:o,"data-za-detail-view-id":5109},a):l.a.createElement("span",null,a))},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.addObserve,n=e.item.attachInfo,a=this.rootRef.current;h.default.setModule(a,{module:"Content"},{attached_info_bytes:n}),this.unobserve=t(a)}},{key:"componentWillUnmount",value:function(){this.unobserve()}},{key:"renderCommentButton",value:function(e,t){var n=this,a=t.href,o=t.byComment,r=t.notificationId;return l.a.createElement("a",{href:"".concat(a).concat(o?"#comment-".concat(o,"?notificationId=").concat(r):""),"data-za-detail-view-id":5109,onClick:function(e){e.preventDefault(),n.props.onCommentsModalOpen(t)}},e)}},{key:"render",value:function(){var e,t=this.props.item,n=t.content,a=n.verb,o=n.actors,r=t.isRead;return l.a.createElement("div",{ref:this.rootRef,className:u()("PushNotifications-item",{"PushNotifications-newItem":!r})},l.a.createElement("span",null,(e=o,Array.isArray(e)||(e=[e]),e.map(function(e,t){return l.a.createElement("span",{className:"PushNotifications-actor",key:t},e.link?l.a.createElement("a",{href:e.link,"data-za-detail-view-id":5109},e.name):l.a.createElement("span",null,e.name))})))," ",a," ",this.renderTarget())}}]),t}(c.Component);t.default=f},2381:function(e,t,n){"use strict";n.r(t);var a,o,r,i,s,c=n(31),l=n(7),m=n(3),u=n(2),d=n(6),p=n(4),h=n(5),f=n(1),v=n.n(f),b=n(0),C=n.n(b),g=n(12),y=n(34),E=n(8),k=n.n(E),O=n(2079),w=n(9),N=n(42),I=(n(2217),"oneself"),j="enterprise",S=[{title:"发表澄清声明",image:"https://zhstatic.zhihu.com/assets/report/Statement@3x.png",description:(a={},Object(l.a)(a,I,"个人可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的方式形式显示在投诉内容的上方，点击可跳转至您的声明全文。"),Object(l.a)(a,j,"企业可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的方式形式显示在投诉内容的上方，点击可跳转至您的声明全文。"),a),defaultReasonIdMap:(o={},Object(l.a)(o,I,46),Object(l.a)(o,j,48),o)},{title:"提交侵权举报",image:"https://zhstatic.zhihu.com/assets/report/Infringement@3x.png",description:C.a.createElement("span",null,"您提交的侵权举报将会根据知乎侵权举报规范进行受理"),defaultReasonIdMap:(r={},Object(l.a)(r,I,47),Object(l.a)(r,j,49),r),memberReasonIdMap:(i={},Object(l.a)(i,I,12),Object(l.a)(i,j,13),i)}],P=(s={},Object(l.a)(s,j,"当您发现知乎上存在涉嫌侵犯您企业合法权益的内容时，您可以先尝试与作者沟通解决，如沟通无效，也可以通过以下方式向知乎提出诉求。"),Object(l.a)(s,I,"当您发现知乎上存在涉嫌侵犯您个人合法权益的内容时，您可以通过以下方式向知乎提出诉求。"),s),R=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(e){g.default.trackEvent(e,{id:3467,aciton:"Click"})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){g.default.trackCardShow(null,{id:3466})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onSubMenuEnter,a=t.onBackClick,o=t.activeId,r=t.isMobile,i=t.type,s=["answer","article","pin"].includes(i)?S:S.slice(1),c=function(e,t){return("member"===e?10===t:29===t)?I:j}(i,o);return C.a.createElement("section",{className:k()("ReportInfringement",{"ReportInfringement--mobile":r})},C.a.createElement("p",{className:"ReportInfringement-subtitle"},P[c]),C.a.createElement("ul",{className:"ReportInfringement-list"},s.map(function(t){var a=t.image,o=t.title,r=t.description,s=t.defaultReasonIdMap,l=t.memberReasonIdMap,m=("member"===i?l:s)[c],u=r[c]||r;return C.a.createElement("li",{className:"ReportInfringement-item",key:o,"data-za-module":"Content","data-za-detail-view-path-module_name":o,onClick:function(t){e.handleClick(t.currentTarget),n(m)}},C.a.createElement("img",{className:"ReportInfringement-image",src:a}),C.a.createElement("div",{className:"ReportInfringement-content"},C.a.createElement("h1",{className:"ReportInfringement-itemTitle"},o),C.a.createElement("p",{className:"ReportInfringement-itemDescription"},u)),C.a.createElement(O.a,{className:"ReportInfringement-arrow"}))})),C.a.createElement(N.a,{direction:"horizontal"},C.a.createElement(w.c,{"data-za-module":"Content","data-za-detail-path-view-module_name":"返回",onClick:function(t){e.handleClick(t.currentTarget),a()}},"返回")))}}]),t}(C.a.Component),T=n(38),L=function(e){return"https://www.zhihu.com/account/infringement?".concat(Object(T.stringify)(e))};n(2218);function D(e){var t=e.infringementType;return C.a.createElement("p",{className:"ReportOrgContent"},"若您已注册机构号，可使用",C.a.createElement("span",{className:"ReportOrgContent-highlight"},"机构号"),"declare"===t?"发表澄清声明":"提交侵权举报","，",C.a.createElement("span",{className:"ReportOrgContent-highlight"},"免提交资质材料"),"。")}n(2219);function M(e){var t=e.infringementType,n=e.isIndividualReason,a=e.onBackClick,o="declare"===t;return C.a.createElement("div",{className:"ReportInfringementMobile"},C.a.createElement("p",{className:"ReportInfringementMobile-text"},"1."," ",o?"".concat(n?"个人":"企业","可以对站内关于自身的不实描述内容发表澄清声明，声明通过审核后，将会以标记的方式形式显示在投诉内容的上方，点击可跳转至您的声明全文。"):"您提交的侵权举报将会根据知乎侵权举报规范进行受理。"),C.a.createElement("p",{className:"ReportInfringementMobile-text"},"2. 根据",C.a.createElement("a",{className:"ReportInfringementMobile-link",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"知乎侵权举报规范"),"，您需按照提示提供完整、有效的证明材料，",o?"以发表澄清声明。":"并规范填写投诉说明。","若您已确认完毕，",C.a.createElement("span",{className:"ReportInfringementMobile-bold"},"请到桌面版网页进行诉求提交。")),!n&&C.a.createElement("p",{className:"ReportInfringementMobile-text"},"若您已注册机构号，可使用机构号".concat(o?"发表澄清声明":"提交侵权举报","，免提交资质材料。")),C.a.createElement("img",{className:"ReportInfringementMobile-img",src:"https://zhstatic.zhihu.com/report/app_report.png"}),C.a.createElement(w.c,{color:w.a.Blue,preset:w.b.Primary,onClick:a,className:"ReportInfringementMobile-button"},"我知道了"))}n(2220);var x=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(e){g.default.trackEvent(null,{id:3469,action:"Click"},{button:{text:e}})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){g.default.trackCardShow(null,{id:3468})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onBackClick,a=t.urlToken,o=t.type,r=46===t.activeId;return t.isMobile?C.a.createElement(M,{isIndividualReason:r,infringementType:"declare",onBackClick:n}):C.a.createElement("section",{className:"ReportDeclare"},C.a.createElement("div",{className:"ReportDeclare-description"},"当您发现知乎上有关于您",r?"个人":"企业","的侵权内容时，您可通过此方式发表澄清声明。",C.a.createElement("br",null),C.a.createElement("br",null),"申请发表澄清声明的流程如下：",C.a.createElement("ul",null,C.a.createElement("li",null,"1. 在站内写一篇",C.a.createElement("a",{href:"https://zhuanlan.zhihu.com/write",target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.handleClick("澄清声明文章")}},"澄清声明文章"),"并发布。",C.a.createElement("a",{href:"https://zhstatic.zhihu.com/assets/report/template-v2.png",target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.handleClick("查看模版")}},"查看模版"),C.a.createElement("br",null)),C.a.createElement("li",null,"2.返回此页面继续发表声明，您需按照提示提供完整、有效的证明材料。",C.a.createElement("br",null)),C.a.createElement("li",null,"3.审核通过后，侵权纠纷内容上会关联展示您的澄清声明，点击可跳转至您的声明全文。")),!r&&C.a.createElement(D,{infringementType:"declare"})),C.a.createElement(N.a,{direction:"horizontal"},C.a.createElement(w.c,{onClick:n},"返回"),C.a.createElement(w.c,{onClick:function(){return e.handleClick("继续发表声明")},component:"a",href:L({infringementType:"declare",resourceId:a,type:o,reasonType:r?"inflictIndividual":"enterprise"}),className:"ReportDeclare-continue",color:w.a.Blue,preset:w.b.Primary},"继续发表声明")))}}]),t}(C.a.Component),A=(n(2221),function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(e){g.default.trackEvent(null,{id:3510,aciton:"Click"},{button:{text:e}})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){g.default.trackCardShow(null,{id:3509})}},{key:"render",value:function(){var e=this,t=this.props,n=t.onBackClick,a=t.urlToken,o=t.type,r=t.activeId,i="member"===o?12===r:47===r;return t.isMobile?C.a.createElement(M,{isIndividualReason:i,infringementType:"trespass",onBackClick:n}):C.a.createElement("section",{className:"ReportTrespass"},C.a.createElement("p",{className:"ReportTrespass-description"},"根据",C.a.createElement("a",{href:"https://www.zhihu.com/terms#sec-report",onClick:function(){e.handleClick("知乎侵权举报规范")}},"知乎侵权举报规范"),"，您需按照提示提供完整、有效的证明材料，并规范填写投诉说明。若您已确认完毕，请继续提交举报信息。"),!i&&C.a.createElement(D,{infringementType:"trespass"}),C.a.createElement(N.a,{direction:"horizontal"},C.a.createElement(w.c,{onClick:function(){e.handleClick("返回"),n()}},"返回"),C.a.createElement(w.c,{onClick:function(){e.handleClick("继续提交举报")},component:"a",href:L({resourceId:a,type:o,reasonType:i?"inflictIndividual":"enterprise"}),className:"ReportTrespass-continue",color:w.a.Blue,preset:w.b.Primary},"继续提交举报")))}}]),t}(C.a.Component)),B=[{id:0,text:"举报",childIds:[1,2,3,4,5,21,7,8,9]},{id:1,text:"低质问题",types:["question"],childIds:[23,33,34,15,35,27,22]},{id:2,text:"垃圾广告信息",reason:"spam",copywriter:{title:"举报说明",placeholder:"举报详细说明（选填）",isRequired:!1},disabled:!0},{id:3,text:"不友善行为",types:["answer","comment","article","column","pin","book_review","favlist","discussion_review"],childIds:[40,41]},{id:4,text:"有害信息",childIds:[19,30,39,26,18,28]},{id:5,text:"涉嫌侵权",childIds:[20,29,12],types:["question","answer","comment","article","column","pin","book_review"],reason:"infringement",disabled:!0},{id:6,types:[]},{id:7,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,reason:"direction",shouldShow:function(e){return e.isColumnArticle}},{id:9,reason:"tipjar",shouldShow:function(e){return e.isTipjarEnabled}},{id:10,reason:"mention"},{id:11,reason:"privacy",disabled:!0},{id:12,reason:"enterprise",disabled:!0,customComponent:R},{id:13,reason:"copy",copywriter:{title:"原文链接或出处",placeholder:"填写原文链接或描述内容出处（必填）"},disabled:!0},{id:14,reason:"defamation",disabled:!0},{id:15,reason:"abuse"},{id:16,reason:"intention"},{id:17,reason:"spam"},{id:18,reason:"illegality",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:19,reason:"politics"},{id:20,reason:"repost",copywriter:{title:"举报说明",placeholder:"原文链接或补充说明（必填）"},types:["answer","article","column","pin","book_review"],disabled:!0},{id:21,reason:"temptation",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0,types:["answer","comment","article","column"]},{id:22,reason:"personal"},{id:23,reason:"ambiguity"},{id:24,reason:"worthless"},{id:25,reason:"rumour"},{id:26,reason:"suicide",types:["question","answer","article","column","pin","book_review","comment"]},{id:27,reason:"medicine"},{id:28,reason:"superstition"},{id:29,reason:"oneself",disabled:!0,customComponent:R},{id:30,reason:"porn"},{id:31,reason:"pirate"},{id:32,reason:"invalid"},{id:33,reason:"subjective"},{id:34,reason:"rumour"},{id:35,reason:"provoke"},{id:36,reason:"edit"},{id:37,reason:"harassment"},{id:38,reason:"hatred"},{id:39,text:"不实信息",types:["answer","comment","article","column","pin","book_review"],childIds:[42,43,44,45]},{id:40,reason:"abuse",text:"骚扰、辱骂、歧视等"},{id:41,reason:"unfriendly",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:42,reason:"untruth_science",text:"科学类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:43,reason:"untruth_rumor",text:"社会谣言类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:44,reason:"untruth_fake_profile",text:"编造经历类不实信息",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:45,text:"诽谤等侵权信息",childIds:[20,29,12]},{id:46,customComponent:x,text:"发表澄清声明",reason:"declare",subtitle:"个人侵权"},{id:47,customComponent:A,text:"提交侵权举报",reason:"trespass",subtitle:"个人侵权"},{id:48,customComponent:x,text:"发表澄清声明",reason:"declare",subtitle:"企业侵权"},{id:49,customComponent:A,text:"提交侵权举报",reason:"trespass",subtitle:"企业侵权"}],F=[{id:0,text:"举报",childIds:[1,2,3,4]},{id:1,text:"垃圾广告信息",reason:"spam"},{id:2,text:"不友善行为",reason:"unkind"},{id:3,text:"有害信息",reason:"imitation"},{id:4,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0}],_=[{id:0,text:"举报",childIds:[1,2,3]},{id:1,reason:"abuse"},{id:2,reason:"harassment"},{id:3,reason:"spam"}],q=[{id:0,text:"举报",childIds:[1,4,6,7]},{id:1,text:"冒充我或他人",childIds:[8,9],reason:"fake",disabled:!0},{id:2,reason:"abuse",text:"发过辱骂我或他人的内容"},{id:3,reason:"illegality",text:"发过违反法律法规的内容"},{id:4,reason:"spam",text:"垃圾广告帐号"},{id:5,reason:"politics",text:"发过政治敏感内容"},{id:6,reason:"profile",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:7,reason:"old",text:"其他",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,text:"冒充我",subtitle:"请选择举报理由",reason:"oneself",disabled:!0,childIds:[10,11]},{id:9,reason:"impersonate",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},text:"冒充他人",disabled:!0},{id:10,text:"个人侵权",isRequired:!0,customComponent:R},{id:11,text:"企业侵权",isRequired:!0,customComponent:R},{id:12,isRequired:!0,customComponent:A,text:"提交侵权举报",reason:"trespass",subtitle:"个人侵权"},{id:13,isRequired:!0,customComponent:A,text:"提交侵权举报",reason:"trespass",subtitle:"企业侵权"}],z=n(26),V=n(24),U=n(52),W=n.n(U),H=n(266),K=n(2081),G=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(d.a)(this,Object(p.a)(t).call(this))).handleClick=e.handleClick.bind(Object(V.a)(e)),e}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleClick",value:function(){var e=this.props,t=e.id,n=e.reason,a=e.disabled,o=e.onSubMenuEnter,r=e.onItemSelect;n&&!a?r(t):o(t)}},{key:"render",value:function(){var e=this.props,t=e.reason,n=e.text,a=e.disabled,o=e.isSelected,r=e.id,i=n||H.b[t];return Boolean(t&&!a)?C.a.createElement("label",{className:"ReportMenu-item",htmlFor:t},C.a.createElement("div",{className:"ReportMenu-itemValue needsclick"},i),C.a.createElement("input",{className:"ReportMenu-itemCheck",type:"radio",name:"report",value:r,id:t,checked:o,onChange:this.handleClick}),C.a.createElement(K.a,{size:18,className:"ReportMenu-itemCheckIcon",name:"checkRound"})):C.a.createElement("button",{className:"ReportMenu-item",onClick:this.handleClick},C.a.createElement("span",{className:"ReportMenu-itemValue"},i),C.a.createElement(O.a,{size:18}))}}]),t}(b.Component);G.propTypes={id:v.a.number.isRequired,reason:v.a.string,text:v.a.string,disabled:v.a.bool,isSelected:v.a.bool,onSubMenuEnter:v.a.func.isRequired,onItemSelect:v.a.func.isRequired};var Q=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){switch(this.props.reason){case"privacy":return C.a.createElement("div",{className:"ReportMenu-inner"},C.a.createElement("div",{className:"ReportMenu-paragraph"},"您好，当您发现知乎上有泄漏您隐私的内容时，您可向知乎进行举报。 请您把以下内容通过邮件发送到 ",C.a.createElement("a",{className:"ReportMenu-link",href:"mailto:i@zhihu.com"},"i@zhihu.com")," 邮箱，我们会尽快处理。"),C.a.createElement("ul",{className:"ReportMenu-paragraph"},C.a.createElement("li",null,"1. 您认为哪些内容泄露了您的隐私？（请在邮件中列出您举报的内容、链接地址，并给出简短的说明）"),C.a.createElement("li",null,"2. 您是谁？（身份证明材料，可以是身份证或护照等证件）")),C.a.createElement("div",{className:"ReportMenu-paragraph ReportMenu-paragraph--light"},"邮件格式请参考",C.a.createElement("a",{className:"ReportMenu-link--light",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"这里"),"；"));case"defamation":return C.a.createElement("div",{className:"ReportMenu-inner"},C.a.createElement("div",{className:"ReportMenu-paragraph"},"您好，当您发现知乎上有诽谤您的内容时，您可以向知乎进行举报。 请您把以下内容通过邮件发送到",C.a.createElement("a",{className:"ReportMenu-link",href:"mailto:i@zhihu.com"}," ","i@zhihu.com"," "),"邮箱，我们会尽快处理。"),C.a.createElement("ul",{className:"ReportMenu-paragraph"},C.a.createElement("li",null,"1. 您举报的内容以及侵犯了您什么权益？（请在邮件中列出您举报的内容、链接地址，并给出简短的说明）"),C.a.createElement("li",null,"2. 您是谁？（身份证明材料，可以是身份证或护照等证件）")),C.a.createElement("div",{className:"ReportMenu-paragraph ReportMenu-paragraph--light"},"邮件格式请参考 ",C.a.createElement("a",{className:"ReportMenu-link--light",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"这里")," ；"));default:return null}}}]),t}(b.Component);Q.propTypes={reason:v.a.string.isRequired};var $=n(58),Z=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.copywriter.placeholder,n=e.onDetailInput,a=e.errorText,o=e.checkCustomReasonContent;return C.a.createElement("div",{className:"ReportMenu-inner"},C.a.createElement($.a,{multiline:!0,grey:!0,rows:5,className:"ReportMenu-textarea",placeholder:t,onChange:function(e){return n(e.target.value)},onBlur:o}),C.a.createElement("div",{className:"ReportMenu-errorText"},a))}}]),t}(b.Component);Z.propTypes={onDetailInput:v.a.func.isRequired,copywriter:v.a.object,errorText:v.a.string};n(2222);var J=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.checked,n=e.onChange,a=e.name,o=e.text,r=e.desc,i=a||o;return C.a.createElement("div",null,C.a.createElement("label",{className:"ReportOption-check",htmlFor:i},C.a.createElement("input",{type:"checkbox",name:i,checked:t,onChange:n}),C.a.createElement("span",null,"同时",o)),r&&C.a.createElement("div",{className:"ReportOption-desc"},r))}}]),t}(b.Component),Y=function(e){return e.length>150?{isLegal:!1,errorReason:H.a.contentTooLong}:/[\u4e00-\u9fa5a-zA-Z0-9]/.test(e)?{isLegal:!0,errorReason:""}:{isLegal:!1,errorReason:H.a.contentIllegal}},X=(n(2223),function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={blockChecked:null,commentChecked:null,activeId:0,parentId:null,selectedId:null,errorText:"",isMobile:!1,isSubmiting:!1,isSubmited:!1,path:[]},n.menuItems={},n.getReportText=function(e){if(!e)return"";var t=n.props.nodes[e];return t&&(t.text||H.b[t.reason])||""},n.getReportLevel=function(){return"第 ".concat(n.state.path.length+1," 级")},n.handleItemSelect=function(e){var t=n.selectedId===e?null:e;n.setState({selectedId:t});var a=n.props,o=a.zaEnabled,r=a.type;t&&o&&g.default.trackEvent(null,{action:"Select",element:"Menu",id:2883,name:n.getReportLevel()},{button:{text:n.getReportText(e)},report:{id:e,type:r}})},n.handleSubMenuEnter=function(e){n.setState(function(t){var n=t.activeId,a=t.path;return{activeId:e,parentId:n,selectedId:null,path:a.concat([e])}});var t=n.props,a=t.zaEnabled,o=t.type;a&&g.default.trackEvent(null,{action:"Expand",element:"Menu",id:2883,name:n.getReportLevel()},{button:{text:n.getReportText(e)},report:{id:e,type:o}})},n.getCommentChecked=function(){var e=n.state,t=e.commentChecked,a=e.parentId,o=e.activeId;return"boolean"==typeof t?t:[2,3].includes(a||o)},n.handleDetailInput=function(e){n.setState({customReason:e,errorText:""})},n.handleBackClick=function(){var e=n.props.nodes,t=n.state,a=t.parentId,o=t.path,r=Object.keys(e).find(function(t){var n=e[t].childIds;return n&&n.includes(a)});n.setState({activeId:a,parentId:r&&Number(r),selectedId:null,hasWarning:!1,customReason:"",errorText:"",path:o.slice(0,-1)});var i=n.props,s=i.zaEnabled,c=i.type;s&&g.default.trackEvent(null,{action:"Back",element:"Button",id:2884,name:n.getReportLevel()},{report:{id:n.state.activeId,type:c}})},n.handleSubmitAppeal=function(){var e="",t=n.state.activeId,a=n.props,o=a.type,r=a.urlToken,i=a.nodes;"enterprise"===i[t].reason||13===t?e="org":"oneself"!==i[t].reason&&37!==t||(e="people"),window.open("//www.zhihu.com/account/complaints/".concat(e,"/").concat(o,"/").concat(r))},n.handleSubmit=function(){var e=n.state,t=e.selectedId,a=e.customReason,o=e.activeId,r=e.parentId,i=n.getCommentChecked();if(n.isSubmitEnabled()&&n.checkCustomReasonContent()){var s=n.props,c=s.nodes,l=s.onSubmit,m=s.onDeleteComment,u=c[t||o],d=u.reason,p=u.id;n.setState({isSubmiting:!0});var h=l({reason:d,customReason:a});h&&h.then?h.then(n.submitEnd):n.submitEnd();var f=m&&[2,3].includes(r||o),v=n.props,b=v.zaEnabled,C=v.type;b&&(g.default.trackEvent(null,{id:2885,name:n.getReportLevel(),action:"Click"},{report:{type:C},button:{text:n.getReportText(p)}}),g.default.trackEvent(Object(V.a)(n),Object.assign({action:"Report",element:"Button"},f&&{id:3039,name:d}),Object.assign({report:{id:p,type:C}},f&&{button:{text:i?"举报并删除":"仅举报"}})))}},n.submitEnd=function(e){n.setState({isSubmiting:!1,isSubmited:!0});var t=n.state.blockChecked,a=n.props,o=a.onBlockUser,r=a.onDeleteComment,i=a.onEnd;Promise.all([t&&o&&o(),n.getCommentChecked()&&r&&r()].map(function(e){return Promise.resolve(e).catch(function(e){return e})})).then(function(t){var n=Object(z.a)(t,2),a=n[0],o=n[1];i&&i({result:e,blockUserResult:a,commentDeleteResult:o})})},n.checkCustomReasonContent=function(){var e=n.state,t=e.activeId,a=e.customReason,o=n.props.nodes[t].copywriter;if((14===t||24===t||Boolean(o))&&a){var r=Y(a),i=r.isLegal,s=r.errorReason;if(!i)return n.setState({errorText:s}),!1}return!0},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.type,t=W()(navigator.userAgent);this.setState({isMobile:t.Mobile}),g.default.trackCardShow(null,{id:2890},{button:{text:e}})}},{key:"componentWillUpdate",value:function(e,t){var n=this.state.activeId,a=t.activeId,o=this.props,r=o.nodes,i=o.onContentChange;if(a!==n){var s=r[a],c=s.reason,l=s.text,m=s.childIds,u=s.copywriter,d=s.subtitle;i(l||H.b[c],d||u&&u.title||(m?void 0:""))}}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.zaEnabled,n=e.type,a=this.state.isSubmited;t&&!a&&g.default.trackEvent(null,{id:4328,action:"Close",name:this.getReportLevel()},{report:{type:n}})}},{key:"isSubmitEnabled",value:function(){var e=this.state,t=e.selectedId,n=e.activeId,a=e.customReason,o=this.props.nodes;return t||(Boolean(o[n].copywriter)||14===n||24===n)&&(!1===o[n].copywriter.isRequired||a)}},{key:"render",value:function(){var e=this,t=this.props,n=t.nodes,a=t.options,o=Object(c.a)(t,["nodes","options"]),r=this.state,i=r.activeId,s=r.parentId,l=r.selectedId,m=r.errorText,u=r.isMobile,d=n[i],p=d.reason,h=d.childIds,f=d.copywriter,v=d.customComponent;if(void 0!==v)return C.a.createElement(v,Object.assign({onBackClick:this.handleBackClick,onItemSelect:this.handleItemSelect,onSubMenuEnter:this.handleSubMenuEnter},this.props,this.state));var b=Boolean(h),g=14===i||24===i||Boolean(f),y=b&&C.a.createElement("div",{className:"ReportMenu-inner ReportMenu-options"},h.map(function(e){return n[e]}).filter(function(e){return e&&(!e.shouldShow||e.shouldShow(o))}).map(function(t){return C.a.createElement(G,Object.assign({ref:function(n){e.menuItems[t.id]=n},key:t.id},t,{isSelected:l===t.id,onSubMenuEnter:e.handleSubMenuEnter,onItemSelect:e.handleItemSelect}))})," ")||g&&C.a.createElement(Z,{onDetailInput:this.handleDetailInput,copywriter:f,errorText:m,checkCustomReasonContent:this.checkCustomReasonContent})||C.a.createElement(Q,{isMobile:u,reason:p}),E=b&&o.talkerToken&&C.a.createElement(J,{checked:this.state.blockChecked,text:"将此人屏蔽",onChange:function(t){return e.setState({blockChecked:t.target.checked})}}),O=s||i,I=o.onDeleteComment&&[2,3].includes(O)&&C.a.createElement(J,{checked:this.getCommentChecked(),desc:Boolean(O)&&"社区鼓励举报".concat(n[O].text,"，同时可以直接删除该评论，删除操作并不影响对违规内容和违规用户的处理。"),onChange:function(t){return e.setState({commentChecked:t.target.checked})},text:"删除该评论"}),j=this.props.isSubmiting;return C.a.createElement("div",{className:k()("ReportMenu",{"ReportMenu-mobile":u})},y,(E||I)&&C.a.createElement("div",null,E,I,a),C.a.createElement(N.a,{direction:"horizontal"},"number"==typeof s&&C.a.createElement(w.c,{onClick:this.handleBackClick}," 返回 "),b||g?C.a.createElement(w.c,{className:"ReportMenu-button",disabled:j||!this.isSubmitEnabled(),onClick:this.handleSubmit,color:"blue",preset:"primary"},"举报"):!u&&C.a.createElement(w.c,{onClick:this.handleSubmitAppeal,preset:"primary",color:"blue"},"进入诉求提交页面")))}}]),t}(b.Component));X.propTypes={nodes:v.a.object.isRequired,onContentChange:v.a.func.isRequired,onSubmit:v.a.func.isRequired,onEnd:v.a.func,onBlockUser:v.a.func,onDeleteComment:v.a.func,isColumnArticle:v.a.bool,isTipjarEnabled:v.a.bool};var ee=X,te=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).filterNodes=function(e,t,n){var a=e.filter(function(e){return!!e.isRequired||(-1!=["infringement","repost","oneself","enterprise","fake"].indexOf(e.reason)||0===e.id||("question"!==t||-1==["closed","suggested","evaluated","locked"].indexOf(n)||0===e.id)&&("member"!==t||-1==["ban","hang"].indexOf(n)||"profile"===e.reason))});return 1===a.length&&0===a[0].id&&(a=[]),a},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.type,a=t.status,o=Object(c.a)(t,["type","status"]);return e="message"===n?_:"member"===n?q:"favlist"===n?F:B.filter(function(e){return!e.types||e.types.includes(n)}),e=this.filterNodes(e,n,a),C.a.createElement(ee,Object.assign({nodes:e.reduce(function(e,t){return Object.assign({},e,Object(l.a)({},t.id,t))},{})},o,{type:n}))}}]),t}(b.Component);te.propTypes={type:v.a.string.isRequired};var ne=n(2137),ae=n(2138),oe=n(53),re="请选择举报理由",ie="举报",se=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={title:void 0!==n.props.title?n.props.title:ie,subtitle:void 0!==n.props.subtitle?n.props.subtitle:re},n.handleSubmit=function(e){var t=e.reason,a=e.customReason,o=n.props,r=o.urlToken,i=o.type;return n.props.doReport(r,i,t,a)},n.handleContentChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re;n.setState({title:e,subtitle:t})},n.handleClose=function(){n.props.zaEnabled&&g.default.trackEvent(n.container,{action:"Ok"},{button:{text:"知道了"}}),n.props.onClose()},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(e){if(!e.shown&&this.props.shown){var t=this.props,n=t.type,a=t.id;g.default.setModule(this.container,{module:"ReportDialog"},{card:{card_type:"Content",content:Object(l.a)({type:Object(ae.a)(n)},"comment"===n?"id":"token",String(a))}})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.shown,a=t.onClose,o=Object(c.a)(t,["shown","onClose"]),r=this.state,i=r.title,s=r.subtitle,l=Object(ne.a)(o,Object.keys(y.b.propTypes)),m=l.selectedProps,u=l.dropedProps;return C.a.createElement(y.b,Object.assign({title:i,subtitle:s,onClose:this.handleClose,className:"ReportModal"},m),n&&C.a.createElement(te,Object.assign({ref:function(t){e.container=t},onSubmit:this.handleSubmit,onEnd:a,onContentChange:this.handleContentChange},u)))}}]),t}(b.Component);se.propTypes={onClose:v.a.func.isRequired,type:v.a.oneOf(oe.a).isRequired,shown:v.a.bool.isRequired,isColumnArticle:v.a.bool,isTipjarEnabled:v.a.bool,onBlockUser:v.a.func,onDeleteComment:v.a.func,doReport:v.a.func.isRequired,zaEnabled:v.a.bool},se.defaultTypes={zaEnabled:!1},n.d(t,"ReportModal",function(){return se})},2382:function(e,t,n){"use strict";n.r(t);var a,o,r,i=n(31),s=n(3),c=n(2),l=n(6),m=n(4),u=n(5),d=n(0),p=n.n(d),h=n(1),f=n.n(h),v=n(13),b=n(8),C=n.n(b),g=n(512),y=n(2132),E=n(73),k=n(2205),O=n.n(k),w=n(2378),N=n(59),I=n(2172),j=n(40),S=n(335),P=n(103),R=n(10),T=n(24),L=n(32),D=n(27),M=n(12),x=n(93),A=n.n(x),B=n(30),F=n.n(B),_=n(9),q=n(520),z=n(66),V=n(224),U=n(81),W=n(158),H=n(159),K=n(2070),G=n(2062),Q=n(77),$=n(21),Z=n(15),J="zhihu::comment_local_key",Y=5,X=(Z.B,1e3),ee=980,te=function(){return""},ne={error:"上传失败",success:"上传成功",uploadIng:"上传中",default:""},ae=(n(2206),Object(v.connect)(null,{showNotification:$.g,uploadImage:Q.b})((r=o=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={uploadStatus:ne.default},n.triggerClick=function(e){var t=n.props.handleInputActive;n.uploadInput.click(),t(!0),e.preventDefault()},n.onError=function(){var e=n.props,t=e.showNotification,a=e.resetUploadImg;t("图片上传失败","red"),a()},n.onSuccess=function(){n.setState({uploadStatus:ne.default})},n.resetFileInput=function(){n.uploadInput.value=null},n.beforeUpload=function(e){var t=n.props.showNotification;return e?e.size>1024*Z.B*1024?(t("请上传小于 ".concat(Z.B,"M 的图片。"),"red"),n.resetFileInput(),!1):(n.reactPopoverNode.open(),void n.setState({uploadStatus:ne.uploadIng})):(n.resetFileInput(),!1)},n.uploadImage=function(e){var t=e.file,a=n.props,o=a.uploadImage,r=a.handleImages,i=a.updatePublishStatus;return o(t).then(function(e){r([Object.assign({},e.payload,{url:e.payload.src})]),i(!1),n.resetFileInput()}).catch(function(){n.setState({uploadStatus:ne.error}),r([])})},n.handleOnRef=function(e){var t=n.props.onRef;t&&t(e),n.reactPopoverNode=e},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.images,a=t.disableButton,o=t.resetUploadImg,r=this.state.uploadStatus,i=Boolean(n.length);return p.a.createElement(d.Fragment,null,p.a.createElement(U.a,{className:"ImagePopover",arrowed:!0,ref:this.handleOnRef,placement:"bottom",globalClose:!n.length,onClick:this.triggerClick,toggler:p.a.createElement(W.a,{label:"插入图片",icon:K.a,disabled:a})},p.a.createElement("div",{className:"ImagePopover-thumbnail"},i&&p.a.createElement(d.Fragment,null,p.a.createElement("img",{src:n[0].src}),p.a.createElement("div",{className:"closeButton",onClick:o},p.a.createElement(G.a,null))),r&&!i&&p.a.createElement("p",{className:"ImagePopover-uplodaStatus"},r))),p.a.createElement(H.a,{accept:"image/png,image/jpeg",onRef:function(t){e.uploadInput=t},beforeUpload:this.beforeUpload,customUpload:this.uploadImage,onSuccess:this.onSuccess,onError:this.onError}))}}]),t}(d.Component),o.propTypes={className:f.a.string,disableButton:f.a.bool},o.defaultProps={disableButton:!0},a=r))||a),oe=n(37),re=n(2071),ie=n(11),se=function(e){return p.a.createElement(ie.a,e,p.a.createElement("path",{d:"M16.375 3.018C19.701 4.643 22 8.047 22 12a9.944 9.944 0 0 1-1.349 5c-1.73 2.986-4.952 5-8.651 5-3.7 0-6.921-2.014-8.651-5A9.944 9.944 0 0 1 2 12c0-3.951 2.298-7.357 5.625-8.982A9.95 9.95 0 0 1 12 2c1.571 0 3.051.373 4.375 1.018zm-4.322 11.17c1.5 0 2.911.662 3.871 1.817a.6.6 0 0 1-.514.978.599.599 0 0 1-.406-.214 3.823 3.823 0 0 0-2.951-1.385c-.605 0-1.185.136-1.723.407a3.85 3.85 0 0 0-1.321 1.093c-.039.05-.091.081-.141.116H8.19c-.006-.004-.013-.003-.018-.006a.6.6 0 0 1-.11-.839 5.074 5.074 0 0 1 1.73-1.433 4.988 4.988 0 0 1 2.26-.534zM8.875 10.75a1.25 1.25 0 1 1 0-2.5 1.25 1.25 0 0 1 0 2.5zm6.25-2.5a1.25 1.25 0 1 1-.001 2.5 1.25 1.25 0 0 1 0-2.5zM19.17 17a8.695 8.695 0 0 0 1.58-5c0-3.23-1.764-6.05-4.375-7.566A8.698 8.698 0 0 0 12 3.25a8.69 8.69 0 0 0-4.375 1.184C5.014 5.95 3.25 8.77 3.25 12c0 1.859.586 3.581 1.579 5 1.583 2.264 4.205 3.75 7.171 3.75 2.965 0 5.586-1.486 7.17-3.75z",fillRule:"evenodd"}))};se.defaultProps={name:"Sad"};var ce=se,le=(n(2207),function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).state={isGifReady:!1,isGifError:!1},n.renderLoadStatus=function(){var e=n.state.isGifError;return p.a.createElement("div",{className:"CommentSticker-load"},e?p.a.createElement(p.a.Fragment,null,p.a.createElement(ce,{className:"CommentSticker-load-Icons"}),"加载失败"):p.a.createElement(p.a.Fragment,null,p.a.createElement(re.a,{className:"CommentSticker-load-Icons"}),"加载中"))};var a=n.props.src;return Object(oe.loadImage)(Object(oe.imgUrl)(a)).then(function(){n.setState({isGifReady:!0})}).catch(function(){n.setState({isGifError:!0})}),n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.state.isGifReady,t=this.props,n=t.src,a=t.handleStickerClick;return p.a.createElement("div",{className:"CommentSticker"},e?p.a.createElement("img",{src:n,className:"CommentSticker-img",onClick:a}):this.renderLoadStatus())}}]),t}(p.a.Component));le.propsTypes={handleStickerClick:f.a.func};var me=le,ue=(n(2208),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).handleOnRef=function(e){var t=n.props.onRef;t&&t(e)},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.sticker,a=e.stickers,o=e.disableButton,r=e.handleStickerPopoverOpen,i=e.handleStickerPopoverClose,s=e.resetStickers,c=e.addSticker,l=e.handleEmotionClick;return p.a.createElement(U.a,{className:t,arrowed:!0,ref:this.handleOnRef,globalClose:!n.length,preventCloseOnTarget:!0,onClick:l,onOpen:r,onClose:i,toggler:p.a.createElement(W.a,{label:"插入表情",icon:re.a,disabled:o}),placement:"bottom"},Boolean(n.length)&&p.a.createElement("li",{className:"StickerPopover-stickers-item StickerPopover-stickers-item-single"},p.a.createElement("img",{src:Object(oe.imgUrl)(n[0].url),alt:n[0].title}),p.a.createElement("div",{className:"closeButton",onClick:s},p.a.createElement(G.a,null))),!n.length&&p.a.createElement("div",{className:"StickerPopover-stickers-wrap"},p.a.createElement("ul",{className:"StickerPopover-stickers-list"},a.map(function(e){var t=e.url,n=e.title,a=e.id;return p.a.createElement("li",{className:"StickerPopover-stickers-item",key:a},p.a.createElement(me,{width:48,height:48,src:t,handleStickerClick:function(){return c(e)}}),p.a.createElement("p",null,n))}))))}}]),t}(d.Component));ue.propTypes={className:f.a.string,disableButton:f.a.bool},ue.defaultProps={disableButton:!0};var de,pe,he,fe;n(2209);function ve(){var e=Object(P.a)(["回复","",""]);return ve=function(){return e},e}var be,Ce,ge,ye,Ee=(de=Object(v.connect)(function(e){return{stickers:e.commentsV2.stickers||[],commentWithPicPermission:e.commentsV2.commentWithPicPermission||{}}},{showNotification:$.g}),Object(D.withRouter)(pe=de((fe=he=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={active:!1,disabled:!0,shown:!1,value:{toHTML:te},images:[],uploadIsFetchingNum:0,sticker:[],stickerIconActive:!1,toggleInputStyle:!1,commentTextLength:0},n.handleSubmit=n.context.authRequired(function(){var e=n.props,t=e.replyTo,a=e.onSubmit,o=e.onCancel,r=e.rootCommentId,i=e.isConversation,s=e.zaInfo.zaSubmitCommentId,c=n.state,l=c.images,m=c.sticker,u=n.input.toHTML();if(u||l.length||m.length){u&&n.saveLocalComment();var d=u;if(l.length||m.length){var p=l[0]||m[0],h=l[0]?l[0].url.includes(".gif")?"comment_gif":"comment_img":"comment_sticker";d+='<a class="'.concat(h,"\" href='").concat(p.url,"' data-width='").concat(p.dataRawwidth||"","' data-height='").concat(p.dataRawheight||"","'>[").concat(p.title||"图片","]</a>")}var f=a(d,t,{rootCommentId:r,isConversation:i});f.then?f.then(function(){o&&o(),n.input?(n.input.reset(),n.resetImage(),n.setState({value:{toHTML:te}},function(){return n.saveLocalComment()})):n.saveLocalComment({toHTML:te})}):(o&&o(),n.input.reset()),M.default.trackEvent(Object(T.a)(n),Object.assign({action:"Comment",element:"Button"},s&&{id:s}))}},void 0,$.b),n.handleCommentShow=n.context.authRequired(function(){n.setState({shown:!0}),n.hiddenInput.focus()}),n.handleCommentHide=function(){n.setState({shown:!1})},n.initLocalComment=function(){var e=n.props,t=e.type,a=e.id;if(t&&a){var o=F.a.get(J)||[],r="".concat(t,"_").concat(a),i=o.find(function(e){return e.key===r}),s=i&&i.value;s&&n.setState({value:{toHTML:function(){return s}},disabled:!1})}},n.saveLocalComment=function(e){var t=n.props,a=t.type,o=t.id;if(a&&o){var r=e?e.toHTML():n.state.value.toHTML(),i="".concat(a,"_").concat(o),s=(F.a.get(J)||[]).filter(function(e){return e.key!==i}),c=r?[].concat(Object(R.a)(s.slice(0,Y-1)),[{key:i,value:r}]):s;F.a.set(J,c)}},n.handleChange=function(e){var t=n.state,a=t.sticker,o=t.images;a.length||o.length?n.setState({value:e}):n.setState({value:e,disabled:e.isEmpty}),n.handleInputChange()},n.handleFocus=function(){n.setState({active:!0},n.handleInputChange)},n.handleBlur=function(){var e=n.state,t=e.sticker,a=e.images;t.length||a.length||(n.setState({active:!1}),n.handleInputChange())},n.handleMobileComment=function(){n.handleSubmit(),n.handleCommentHide()},n.handleEmotionClick=function(){var e=n.state.stickerIconActive;e&&n.setState({stickerIconActive:e},n.stickerPopover.close)},n.handleInputChange=function(){var e,t=Object(L.findDOMNode)(n.input);t&&(t.getBoundingClientRect().height>40?n.setState({toggleInputStyle:!0}):n.setState({toggleInputStyle:!1}),e="innerText"in document?t.innerText.length:t.textContent.length,n.setState({commentTextLength:e}),n.imgUploadPopover&&n.imgUploadPopover.position(),n.stickerPopover&&n.stickerPopover.position())},n.handleStickerPopoverOpen=function(){n.setState({active:!0,stickerIconActive:!0},n.stickerPopover.position),setTimeout(n.stickerPopover.position,400)},n.handleStickerPopoverClose=function(){n.setState({stickerIconActive:!1})},n.handleImages=function(e){n.setState({images:e},n.imgUploadPopover.position)},n.handleInputActive=function(e){n.setState({active:e})},n.updatePublishStatus=function(e){n.setState({disabled:e})},n.resetStickers=function(){var e=n.state.value,t=void 0===e.isEmpty||e.isEmpty;n.stickerPopover&&n.stickerPopover.close(),n.setState({sticker:[],disabled:t})},n.resetImage=function(){n.resetStickers(),n.resetUploadImg()},n.resetUploadImg=function(){var e=n.state.value,t=void 0===e.isEmpty||e.isEmpty;n.imgUploadPopover&&n.imgUploadPopover.close(),n.setState({images:[],disabled:t})},n.addSticker=function(e){n.setState({sticker:[e],disabled:!1},n.stickerPopover.position)},n.focusInput=function(e){e.preventDefault(),n.input.focus()},n.createImageOnRef=function(e){n.imgUploadPopover=e},n.createStickerOnRef=function(e){n.stickerPopover=e},n.renderInput=function(e){var t=e.placeholder,a=e.className,o=n.props,r=o.autoFocus,i=o.stickers,s=o.commentWithPicPermission.commentWithPic,c=n.state,l=c.images,m=c.sticker,u=c.stickerIconActive,d=c.toggleInputStyle,h=c.active,f=c.disabled,v=c.commentTextLength,b=Boolean(m.length)||Boolean(l.length);return p.a.createElement("div",{className:C()("CommentEditorV2-inputWrap",{"CommentEditorV2-inputWrap--change":d,"CommentEditorV2-inputWrap--active":h||!f}),onClick:function(e){e.nativeEvent.stopImmediatePropagation()}},p.a.createElement(z.b,{keyMap:{FOCUS_COMMENT_INPUT:"shift+c"},handlers:{FOCUS_COMMENT_INPUT:n.focusInput}}),p.a.createElement(V.a,{className:C()("CommentEditorV2-input",a),defaultValue:n.state.value.toHTML(),richtext:!0,large:!0,spread:!0,allowMention:!0,allowPasteRichText:!1,autoFocus:r,outputBlockType:"div",onRef:function(e){n.input=e},placeholder:t,onFocus:n.handleFocus,onChange:n.handleChange,onSubmit:n.handleSubmit,minRows:5}),p.a.createElement("div",{className:C()("CommentEditorV2-inputUpload",{"CommentEditorV2-inputUpload--FlexEnd":d,"CommentEditorV2-inputUpload--SpaceBetween":d&&v>ee})},d&&v>ee&&p.a.createElement(q.a,{className:"CommentEditorV2-MaxLength",current:v,max:X}),p.a.createElement("div",{className:"CommentEditorV2-popoverWrap"},s&&p.a.createElement(ae,{onRef:n.createImageOnRef,images:l,disableButton:b,resetUploadImg:n.resetUploadImg,handleInputActive:n.handleInputActive,updatePublishStatus:n.updatePublishStatus,handleImages:n.handleImages}),p.a.createElement(ue,{className:C()("CommentEditorV2-inputUpLoad-Icon",{"CommentEditorV2-inputUpLoad-Icon--active":u&&!m.length}),onRef:n.createStickerOnRef,disableButton:b,handleEmotionClick:n.handleEmotionClick,handleStickerPopoverOpen:n.handleStickerPopoverOpen,handleStickerPopoverClose:n.handleStickerPopoverClose,stickerIconActive:u,sticker:m,stickers:i,resetStickers:n.resetStickers,addSticker:n.addSticker}))))},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.initLocalComment(),document.addEventListener("click",this.handleBlur)}},{key:"componentWillUnmount",value:function(){this.saveLocalComment(),document.removeEventListener("click",this.handleBlur)}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,a=e.className,o=e.ownerAuthorIsOrg,r=e.ownerAuthorIsBrand,i=this.state,s=i.active,c=i.disabled,l=o?"机构":"作者",m={preset:"primary",color:"blue",children:"发布",disabled:c};if(t&&t.author){var u=A()(ve(),t.author.member.name,n?"，评论由".concat(l,"筛选后公开"):"");return p.a.createElement("div",{className:C()(a,"CommentEditorV2--normal",{"CommentEditorV2--active":s||!c})},this.renderInput({placeholder:u}),p.a.createElement(_.c,Object.assign({},m,{className:"CommentEditorV2-singleButton",onClick:this.handleSubmit})))}var d="写下你的评论...";return n&&(d=r?"已开启预审评论，评论由品牌筛选后公开":o?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示"),p.a.createElement("div",{className:C()(a,"CommentEditorV2--normal",{"CommentEditorV2--active":s||!c})},this.renderInput({placeholder:d}),p.a.createElement(_.c,Object.assign({},m,{className:"CommentEditorV2-singleButton",onClick:this.handleSubmit})))}}]),t}(d.Component),he.propTypes={className:f.a.string,defaultActive:f.a.bool,replyTo:f.a.object,inCommentItem:f.a.bool,commentNeedsReview:f.a.bool,canComment:f.a.object,onCancel:f.a.func,onSubmit:f.a.func.isRequired,zaInfo:f.a.object},he.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1,zaInfo:{}},he.contextTypes={authRequired:f.a.func},pe=fe))||pe)||pe),ke=n(2136),Oe=n(513),we=n(50),Ne=n(853),Ie=n(2053),je=n(851),Se=n(2056),Pe=n(2057),Re=n(854),Te=n(2058),Le=n(852),De=n(2055),Me=n(114),xe=n(271),Ae=n(113),Be=n(46),Fe=n(223),_e=n(112),qe=(n(2210),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={previewImg:null},n.handlePreview=function(e){var t=e.target,a=n.props.onPreviewImage;"function"==typeof a?a(e).catch(function(){n.setState({previewImg:t})}):n.setState({previewImg:t})},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"mount",value:function(){var e=this;this.imagesGifNode=this.root.getElementsByClassName("comment_gif"),this.imagesNode=this.root.getElementsByClassName("comment_img"),this.imagesStickerNode=this.root.getElementsByClassName("comment_sticker"),this.imgNode=this.root.getElementsByClassName("origin_image zh-lightbox-thumb"),this.imagesNodes=Array.from([].concat(Object(R.a)(this.imagesGifNode),Object(R.a)(this.imagesNode),Object(R.a)(this.imagesStickerNode),Object(R.a)(this.imgNode))).map(function(t){var n=t.dataset||{},a=n.width,o=n.height,r=n.rawwidth,i=n.rawheight,s=Number(a||r),c=Number(o||i),l=document.createElement("div");l.className="Richtext-content_img",t.parentNode.replaceChild(l,t);var m=t.getAttribute("href")||t.getAttribute("src"),u=new Image,d=t.getAttribute("class");return"comment_sticker"!==d&&l.addEventListener("click",e.handlePreview),u.className=d,u.src=m,u.dataset.original=Object(oe.imgUrl)(m,"r"),u.dataset.rawwidth=s,u.onload=function(){s===c||"comment_sticker"===d?l.classList.add("Richtext-content_img-square"):s>c?l.classList.add("Richtext-content_img-square--wideShape"):l.classList.add("Richtext-content_img-square--highShape"),l.appendChild(u)},l})}},{key:"unmount",value:function(){this.imagesNodes&&this.imagesNodes.forEach(function(e){Object(L.unmountComponentAtNode)(e)})}},{key:"componentDidMount",value:function(){this.mount()}},{key:"componentWillUpdate",value:function(e){this.props.html!==e.html&&this.unmount()}},{key:"componentDidUpdate",value:function(e){e.html!==this.props.html&&this.mount()}},{key:"componentWillUnmount",value:function(){this.unmount()}},{key:"render",value:function(){var e=this,t=this.state.previewImg,n=this.props,a=n.html,o=n.className;return p.a.createElement("div",{className:C()("CommentRichText",o),ref:function(t){return e.root=t}},p.a.createElement(_e.a,{html:a}),t&&p.a.createElement(Fe.a,{className:"CommentRichText-ImageView",img:t,onClose:function(){return e.setState({previewImg:null})}}))}}]),t}(d.Component)),ze=n(85),Ve=n(353),Ue=(n(2211),be=Object(v.connect)(function(e){return{isWechat:e.env.userAgent.Wechat,permission:Object(Me.c)(e)}}),Object(D.withRouter)(Ce=be((ye=ge=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={reportModalShown:!1,isReplying:!1,collapsed:!0,guideShown:!1,deleteModal:!1},n.toggleReply=n.context.authRequired(function(){n.setState({isReplying:!n.state.isReplying})},void 0,$.b),n.openReportModal=n.context.authRequired(function(){n.setState({reportModalShown:!0})}),n.like=n.context.authRequired(function(e){var t=n.props;(0,t.onLike)(t.comment.id,e)},Z.E.like,$.b),n.dislike=n.context.authRequired(function(){var e=n.props;(0,e.onDislike)(e.comment.id)},Z.E.like,$.b),n.delete=function(){var e=n.props;return(0,e.onDelete)(e.comment.id)},n.feature=function(e){var t=n.props,a=t.onFeature,o=t.comment.id;a(e?"".concat(o,"_featured"):o)},n.collapse=function(){var e=n.props;(0,e.onCollapse)(e.comment.id)},n.approve=function(){var e=n.props;(0,e.onApprove)(e.comment.id)},n.reject=function(){var e=n.props;(0,e.onReject)(e.comment.id)},n.showConversation=function(e){var t=n.props;(0,t.onShowConversation)({commentId:t.comment.id,isAnchorComments:e})},n.stopReply=function(){n.setState({isReplying:!1})},n.closeReportModal=function(e){if(e){var t=e.result.payload,a=t&&t.message||t&&t.code&&"举报失败";e.commentDeleteResult&&!(e.commentDeleteResult.payload||{}).code?xe.b.showModal({reportText:a}):Object(ze.b)(a||"举报成功")}n.setState({reportModalShown:!1})},n.handleToggleGuide=function(){n.setState({guideShown:!n.state.guideShown})},n.handleCloseDelete=function(){return n.setState({deleteModal:!1})},n.handleDelete=function(){return n.setState({deleteModal:!0})},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:p.a.createElement("span",{className:"CommentItemV2-roleInfo"},"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) ")}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var a=t.member,o=void 0===a?{}:a,r=t.role;return p.a.createElement(p.a.Fragment,null,p.a.createElement("span",{className:"CommentItemV2-reply"},"回复"),p.a.createElement(Be.a,{noBadge:!0,noHoverCard:!0,user:o}),this.renderRoleInfo(r,n))}},{key:"renderItem",value:function(){var e,t=this,n=this.props,a=n.comment,o=a.isDelete,r=a.collapsed,i=n.isConversation,s=n.ownerAuthorIsOrg,c=r&&i&&this.state.collapsed,l=o||c,m=this.state,u=m.reportModalShown,d=m.isReplying,h=this.props,f=h.parent,v=f.canComment,b=(v=void 0===v?{status:!0}:v).status,g=f.questionType,y=h.commentNeedsReview,E=h.comment,k=h.onReply,O=h.status,w=h.type,N=h.canOperate,I=h.commentPattern,j=h.rootCommentId,S=h.byComment,P=h.isReverseAndStatusOpen,R=h.hasRecommend,T=h.permission.canBrandAdminEdit,L=E.id,D=E.author,M=E.content,x=E.voteCount,A=E.replyToAuthor,B=E.isAuthor,F=E.createdTime,q=E.featured,z=E.voting,V=E.reviewing,U=E.disliked,W=E.resourceType,H=E.childCommentCount,K=E.allowDelete,G=E.allowVote,Q=E.canRecommend,$=E.canCollapse,Z=E.collapsedReason,J=void 0===Z?"":Z,Y=r&&i?"该评论已被折叠":M,X=D||{},ee=X.member,te=X.role,ne=Boolean(A),ae=q&&(H>0||ne)&&!i||S&&ne||P&&ne,oe=B||K&&("question"!==w||"commercial"===g),re=p.a.createElement("div",{className:"CommentItemV2-footer"},p.a.createElement(_.c,{className:C()("CommentItemV2-likeBtn",z&&"is-liked"),preset:"plain",onClick:this.like,disabled:B},p.a.createElement(Ne.a,{style:{marginRight:5},center:!0,size:16}),x>0?x:"赞"),r&&J&&p.a.createElement("div",{className:"CommentItemV2-walleTag"},"阴阳怪气自动折叠"===J&&p.a.createElement(Ie.a,{size:16,className:"CommentItemV2-walleIcon"}),J),ae&&p.a.createElement(_.c,{preset:"plain",className:"CommentItemV2-talkBtn",onClick:function(){return t.showConversation(ne)}},p.a.createElement(je.a,{style:{marginRight:5},center:!0,size:16}),"查看回复"),!B&&b&&!r&&p.a.createElement(_.c,{preset:"plain",className:C()({"CommentItemV2-hoverBtn":!d}),onClick:this.toggleReply},p.a.createElement(Se.a,{style:{marginRight:5},center:!0,size:16}),d?"取消回复":"回复"),Q&&!R&&N&&p.a.createElement(_.c,{className:C()({"CommentItemV2-hoverBtn":!B&&!d}),preset:"plain",onClick:function(){return t.feature(q)}},p.a.createElement(Pe.a,{style:{marginRight:5},center:!0,size:16}),q?"取消推荐":"推荐"),$&&!B&&p.a.createElement(_.c,{className:C()({"CommentItemV2-hoverBtn":!B&&!d}),preset:"plain",onClick:this.collapse},p.a.createElement(Re.a,{style:{marginRight:5},center:!0,size:14}),r?"取消折叠":"折叠"),G&&!B&&N&&p.a.createElement(_.c,{className:C()({"CommentItemV2-hoverBtn":!d}),preset:"plain",onClick:this.dislike},p.a.createElement(Ne.a,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),U?"取消踩":"踩"),B||p.a.createElement(p.a.Fragment,null,p.a.createElement(_.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.openReportModal},p.a.createElement(Te.a,{style:{marginRight:5},center:!0,size:16}),"举报"),"question"===w&&"commercial"===g&&T&&p.a.createElement(_.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.reject},p.a.createElement(Re.a,{style:{marginRight:5},center:!0,size:16}),"隐藏")),oe&&p.a.createElement(_.c,{className:C()({"CommentItemV2-hoverBtn":!B&&!d&&!d}),preset:"plain",onClick:this.handleDelete},p.a.createElement(Le.a,{style:{marginRight:5},center:!0,size:16}),"删除"),p.a.createElement(xe.a,{shown:this.state.deleteModal,id:L,onDelete:this.delete,onClose:this.handleCloseDelete}),p.a.createElement(Ae.b,Object.assign({type:"comment",urlToken:L,shown:u,onClose:this.closeReportModal},oe&&{onDeleteComment:this.delete},{notification:{failure:Ve.a},zaEnabled:!0})));return e=d?p.a.createElement("div",null,re,p.a.createElement(Ee,{type:"comment",id:L,commentNeedsReview:y,className:"CommentItemV2-editor",defaultActive:!0,replyTo:E,onCancel:this.stopReply,onSubmit:k,rootCommentId:j,isConversation:i})):"reviewing"===O?p.a.createElement("div",{className:"CommentItemV2-footer"},p.a.createElement(_.c,{preset:"plain",onClick:this.approve},p.a.createElement(De.a,{style:{marginRight:5},center:!0,size:14}),"公开"),p.a.createElement(_.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.handleDelete},p.a.createElement(Le.a,{style:{marginRight:5},center:!0,size:16}),"删除"),p.a.createElement(xe.a,{shown:this.state.deleteModal,id:L,onDelete:this.delete,onClose:this.handleCloseDelete})):re,p.a.createElement("div",null,p.a.createElement("div",{className:"CommentItemV2-meta"},ee&&p.a.createElement(Be.a,{className:"CommentItemV2-avatar",avatar:!0,noHoverCard:"fixed"===I,user:ee}),ee&&p.a.createElement(Be.a,{noBadge:!0,noHoverCard:!0,user:ee}),this.renderRoleInfo(te,W),this.renderReplyTo(),V&&p.a.createElement(Re.a,{className:"CommentItemV2-reviewing","data-tooltip":"".concat(!1===s?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),center:!0,size:14}),p.a.createElement("span",{className:"CommentItemV2-time"},Object(we.toRelativeString)(F))),p.a.createElement("div",{className:"CommentItemV2-metaSibling"},p.a.createElement(qe,{className:C()("CommentItemV2-content",{"CommentItemV2-shield":l}),html:Y}),!l&&e))}},{key:"render",value:function(){return this.renderItem()&&p.a.createElement("div",{className:"CommentItemV2",ref:this.props.onRef},this.renderItem())}}]),t}(d.Component),ge.propTypes={comment:f.a.object.isRequired,parent:f.a.object.isRequired,commentNeedsReview:f.a.bool,type:f.a.string,isConversation:f.a.bool,onLike:f.a.func.isRequired,onShowConversation:f.a.func,onReply:f.a.func,onFeature:f.a.func,onDelete:f.a.func.isRequired,onCollapse:f.a.func,commentPattern:f.a.string},ge.contextTypes={currentUser:f.a.object,authRequired:f.a.func},Ce=ye))||Ce)||Ce),We=n(7),He=(n(2212),5),Ke=2,Ge=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={},n.handleClick=function(){var e=n.props,t=e.loadRestComments,a=e.onShowConversation,o=e.comment,r=o.id,i=o.childCommentCount,s=i<=He&&i>Ke;(s?t:a)({commentId:r}),s&&n.setState(Object(We.a)({},"hide_".concat(r),!0))},n.handleRef=function(e){var t=n.props.onRef;"function"==typeof t&&t(e)},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.comment,n=t.id,a=t.childCommentCount,o=e.isFetching,r=e.className,i=this.state["hide_".concat(n)],s=a<=He&&a>Ke?"展开其他 ".concat(a-Ke," 条回复"):"查看全部 ".concat(a," 条回复");return p.a.createElement("div",{className:r,ref:this.handleRef},!i&&p.a.createElement("div",{className:"CommentMoreReplyButton"},p.a.createElement(_.c,{preset:"plain",onClick:this.handleClick},s)),o&&p.a.createElement(N.a,{className:"CommentMoreReplyButton",small:!0}))}}]),t}(d.Component);Ge.propTypes={comment:f.a.object.isRequired,isFetching:f.a.bool,onShowConversation:f.a.func,loadRestComments:f.a.func};n(2213);var Qe,$e=Object(v.connect)(null,{loadConversation:g.g})(Qe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).loadRestComments=function(e){var t=e.commentId;(0,n.props.loadConversation)({id:t,isLoadRest:!0})},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.parent,n=t.type,a=t.author,o=(a=void 0===a?{isOrg:!1}:a).isOrg,r=e.parent,i=e.commentNeedsReview,s=e.onShowConversation,c=e.status,l=e.onItemLike,m=e.onItemDelete,u=e.onItemCollapse,h=e.onItemDislike,f=e.onItemApprove,v=e.onItemReject,b=e.canOperateItem,g=e.commentPattern,y=e.conversation,E=void 0===y?{}:y,k=e.entities,O=e.byComment,w=e.isReverseAndStatusOpen,N=e.comment,I=e.onReply,j=e.onFeature,S=e.ids,P=N.id,R=N.featured,T=N.childComments,L=void 0===T?[]:T,D=N.childCommentCount,M=void 0===D?0:D,x=R?"".concat(P,"_featured"):"".concat(P),A=!R&&S.includes("".concat(P,"_featured")),B=Boolean(L.length)&&!w,F=M<=5&&M>2,_=L.map(function(e){return k.comments[e]}),q=!R&&M>2&&!w,z=(F&&E[P]||{isFetching:!1}).isFetching;return p.a.createElement(d.Fragment,null,p.a.createElement("li",{className:C()({"NestComment--rootCommentNoChild":!B,"NestComment--rootComment":B}),key:x},p.a.createElement(Ue,{key:x,comment:N,status:c,type:n,parent:r,canOperate:b,commentNeedsReview:i,onShowConversation:s,ownerAuthorIsOrg:o,onLike:l,onReply:I,onFeature:j,onDelete:m,onCollapse:u,onDislike:h,onApprove:f,onReject:v,commentPattern:g,rootCommentId:P,byComment:O,isReverseAndStatusOpen:w,hasRecommend:A})),B&&_.map(function(e){var t=e.id,a=e.featured,d=a?"".concat(t,"_featured"):"".concat(t),C=!a&&S.includes("".concat(t,"_featured"));return p.a.createElement("li",{className:"NestComment--child",key:d},p.a.createElement(Ue,{key:d,comment:e,status:c,type:n,parent:r,canOperate:b,commentNeedsReview:i,onShowConversation:s,ownerAuthorIsOrg:o,onLike:l,onReply:I,onFeature:j,onDelete:m,onCollapse:u,onDislike:h,onApprove:f,onReject:v,commentPattern:g,rootCommentId:P,hasRecommend:C}))}),q&&p.a.createElement(Ge,{comment:N,isFetching:z,onShowConversation:s,loadRestComments:this.loadRestComments}))}}]),t}(d.Component))||Qe,Ze=n(65),Je=n(109),Ye=n(25);function Xe(e){var t=e.id,n=e.replyTo,a=e.isConversation;if(e.isNotification)return{type:"notification"};if(a)return{type:"conversation"};if(!n)return{type:"comment"};var o=n.featured,r=n.replyToAuthor,i=n.id;return t===i&&o?r?{type:"replyToSubFeatured"}:{type:"replyToFeatured"}:t!==i||r?t!==i&&r?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}n(2214);var et,tt,nt,at=Object(v.connect)(function(e,t){var n=t.parent,a=t.parent,o=a.type,r=a.id,i=t.status,s=t.order,c=t.byComment,l=t.commentPattern,m=t.notificationId,u=e.entities,d=e.commentsV2,p=e.commentsV2,h=p.conversation,f=p.stickers,v=void 0===f?[]:f,b=p.commentWithPicPermission,C=p.notificationsComments,g="".concat(o,"_").concat(r),y=d.parent,E=u.comments[c],k=d.pagination;"reviewing"===i&&(k=d.reviewing);var w="reverse"===s&&"open"===i;w&&(k=d.reverse);var N=[],I=d.collapsed[g]||{};I.ids&&I.ids.length>0&&(N=I.ids.map(function(e){return u.comments[e]}));m&&(k=C,g=m);var j=k[g]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},S=j.isFetching,P=j.isPrevDrained,R=j.isDrained,T=j.ids,L=j.newIds,D=void 0===L?[]:L,M=j.totals,x="bottom"!==l?T:D,A=x.map(function(e){return u.comments[e]}),B=O()(x,function(e){return String(e).includes("_featured")});return{currentUser:Object(Ye.c)(e),isFetching:S,isPrevDrained:P,isDrained:R,totals:m?A.length:M,collapsedInfo:I,collapsedComments:N,targetComment:E,conversation:h,entities:u,stickers:v,lastFeaturedIndex:B,comments:A,isReverseAndStatusOpen:w,commentWithPicPermission:b,ids:x,parent:Object.assign({},n,{},y[g]),permission:Object(Me.c)(e)}},{loadComments:g.f,loadConversation:g.g,addComment:g.a,loadStickers:g.j,clearNotification:$.d,getCommentWithPicPermission:g.e,loadNotificationComments:g.i,loadAnswerCommentPermission:Ze.c,loadArticleCommentPermission:Je.b})((nt=tt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={collapsed:!0,current:1,packupButtonStatus:!1,packupButtonLeft:0},n.load=function(e,t,a){if(!n.props.isFetching&&!n.props.parent.adminClosedComment){var o=e||n.props,r=o.order,i=o.status,s=o.parent,c=s.id,l=s.type,m=o.commentPattern,u=o.needLoadCommentPermission,d=o.loadComments,p=o.notificationId,h=o.loadNotificationComments;if(p)return h(p);if(u&&n.loadCommentPermission(l,c),a){d(l,c,{order:r,isPrevious:t,status:"collapsed",commentPattern:m},!0)}else d(l,c,{order:r,isPrevious:t,status:i,commentPattern:m})}},n.addComment=function(e,t,a){var o=a.rootCommentId,r=a.isConversation,i=n.props,s=i.parent,c=s.id,l=s.type,m=i.commentId,u=i.addComment,d=i.notificationId;return u({parentType:l,parentId:c,content:e,replyTo:t,conversationId:m,rootCommentId:o,isConversation:r,notificationId:d,replyType:Xe({id:o,replyTo:t,isConversation:r,isNotification:Boolean(d)}).type})},n.featureItem=function(e){(0,n.props.onItemFeature)(e,n.lastFeaturedIndex)},n.handleOpenCollapsed=function(){n.setState({collapsed:!1}),n.load(n.props,!1,!0)},n.handleScroll=function(){if(n.commentsElement&&n.commentsWithPaginationEl){var e=window.innerHeight,t=n.state.packupButtonStatus,a=n.commentsWithPaginationEl.getBoundingClientRect(),o=a.top,r=a.bottom,i=a.height;!t&&i>500&&r>e&&o<0?n.setState({packupButtonStatus:!0}):t&&(i<=500||r<=e||o>=0)&&n.setState({packupButtonStatus:!1})}},n.handlePageSelect=function(e){var t=n.props.onPaginationClick,a=n.state.current;t&&t(a,e),n.commentsElement.scrollIntoView(),n.setState({current:e}),n.loadByPagination(e)},n.loadByPagination=function(e,t){var a=t||n.props,o=a.order,r=a.status,i=a.parent,s=i.id,c=i.type,l=a.commentPattern,m=a.needLoadCommentPermission,u=a.loadComments;m&&n.loadCommentPermission(c,s),u(c,s,{order:o,isPrevious:!1,status:r,commentPattern:l,current:e})},n.renderComment=function(e){var t=e.id,a=e.featured?"".concat(t,"_featured"):t;return p.a.createElement("ul",{className:"NestComment",key:a},p.a.createElement($e,Object.assign({comment:e,onReply:n.addComment,onFeature:n.featureItem},n.props)))},n.renderNormalComments=function(e){var t=n.state.collapsed,a=n.props,o=a.byComment,r=a.lastFeaturedIndex,i=a.parent,s=i.featuredCounts,c=i.commonCounts,l=[],m=s>0;return n.lastFeaturedIndex=0,e.length>0&&e.forEach(function(a,i){if(o||!a.collapsed){var u=e[i-1];a.collapsed&&(u&&u.collapsed||l.push(n.renderCollapsedDivider()),t)||(i===r&&l.push(p.a.createElement("div",{className:"NestComment-nextSiblings--noBorder",key:"NestComment-nextSiblings--noBorder"})),m&&0===i&&-1!==r&&l.push(p.a.createElement("div",{className:"CommentListV2-header-divider",key:"divider-featured"},"精选评论（",s,"）")),l.push(n.renderComment(a)),i===r&&(n.lastFeaturedIndex=i,l.push(p.a.createElement("div",{className:"CommentListV2-header-divider",key:"divider-comment"},"评论（",c,"）"))))}}),l},n.renderCollapsedComments=function(){var e=[],t=n.props,a=t.collapsedComments,o=t.isDrained,r=t.parent,i=(r=void 0===r?{}:r).collapsedCounts;return!o||i<=0?[]:(e.push(a.map(function(e){return n.renderComment(e)})),e)},n.renderComments=function(e){return e.map(n.renderComment)},n.renderCollapsedDivider=function(){var e=n.props,t=e.isDrained,a=e.parent.collapsedCounts;return!t||a<=0?[]:n.state.collapsed?p.a.createElement("div",{className:"CommentListV2-action",key:"collapsed"},p.a.createElement("div",{className:"CommentListV2-expendCollapseButton"},p.a.createElement("span",{onClick:n.handleOpenCollapsed},Object(j.formatNumber)(a)," 条评论被折叠"),"（",p.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):p.a.createElement("div",{className:"CommentListV2-divider",key:"divider-collapsed"},p.a.createElement("div",{className:"CommentListV2-dividerLine"}),p.a.createElement("div",{className:"CommentListV2-dividerText"},Object(j.formatNumber)(a)," 条评论被折叠（",p.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},n.renderCollapsedInfiLoader=function(){var e=n.state.collapsed;if(e)return[];var t=n.props.collapsedInfo,a=(t=void 0===t?{}:t).isFetching,o=t.isPrevDrained,r=t.isDrained;return p.a.createElement(N.b,{className:"CommentListV2",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:a,isPrevDrained:o,isDrained:r,onLoad:function(t){return n.load(n.props,t,!e)},placeholder:p.a.createElement(N.a,{className:"CommentItem",small:!0})},n.renderCollapsedComments())},n.renderPatternContent=function(e){var t=n.props,a=t.isFetching,o=t.parent.adminClosedComment,r=t.byComment,i=t.status,s=t.order,c=t.totals,l=t.showPackupButton,m=t.handlePackupButton,u=Math.ceil(c/20),d=n.state,h=d.current,f=d.packupButtonStatus,v=d.packupButtonLeft;return o?null:a?p.a.createElement(ke.a,{onRef:function(e){n.commentsWithPaginationEl=e}}):p.a.createElement("div",{ref:function(e){n.commentsWithPaginationEl=e}},p.a.createElement("div",{className:"CommentListV2"},"normal"===s&&"open"===i?n.renderNormalComments(e):n.renderComments(e)),u>1&&p.a.createElement(I.a,{className:"CommentsV2-pagination",current:h,total:u,onSelect:n.handlePageSelect}),!r&&n.renderCollapsedDivider(),!r&&n.renderCollapsedInfiLoader(),p.a.createElement(y.CSSTransitionGroup,{transitionName:"CommentsV2-Packup-Button",transitionEnterTimeout:300,transitionLeaveTimeout:300},l&&f&&p.a.createElement("button",{onClick:m,className:"CommentsV2-Packup-Button",style:{left:v}},"收起评论",p.a.createElement(w.a,{center:!0}))))},n.renderModalContent=function(e){var t=n.props,a=t.collapsedInfo,o=t.parent.adminClosedComment,r=t.status,i=t.order,s=t.byComment,c=n.state.collapsed,l=c?n.props:a,m=l.isFetching,u=l.isDrained,d=l.isPrevDrained;if(u&&e.length<=0||o)return p.a.createElement("div",{className:"CommentsV2-empty"},p.a.createElement(S.a,{entityType:"comments"}));return p.a.createElement(N.b,Object.assign({className:"CommentListV2",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:m,isPrevDrained:d,isDrained:u,onLoad:function(e){return n.load(n.props,e,!c)},placeholder:p.a.createElement(N.a,{className:"CommentItemV2",small:!0})},{getContainer:function(e){return e}}),"normal"===i&&"open"===r?n.renderNormalComments(e):n.renderComments(e),!s&&n.renderCollapsedDivider(),!s&&n.renderCollapsedComments())},n.renderCommentEdit=function(){var e=n.props,t=e.parent,a=t.canComment,o=(a=void 0===a?{status:!0}:a).status,r=a.reason,i=t.author,s=(i=void 0===i?{isOrg:!1}:i).isOrg,c=t.type,l=t.id,m=t.adminClosedComment,u=t.questionType,d=e.byComment,h=e.autoFocus,f=e.commentNeedsReview,v=e.zaInfo,b=m?"当前内容暂时无法评论":r,g=h&&!d;return o&&!m?p.a.createElement(Ee,{className:"CommentsV2-footer",type:c,id:l,commentNeedsReview:f,onSubmit:n.addComment,autoFocus:g,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===u,zaInfo:v}):p.a.createElement("div",{className:C()("CommentsV2-disabledText")},p.a.createElement("div",{className:"CommentsV2-disabledReason"},b))},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"loadCommentPermission",value:function(e,t){var n=this.props,a=n.loadAnswerCommentPermission,o=n.loadArticleCommentPermission;switch(e){case"answer":return a(t);case"article":return o(t);default:return null}}},{key:"componentDidMount",value:function(){this.subscription=Object(E.subscribe)("scroll",this.handleScroll);var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,a=e.stickers,o=e.loadStickers,r=e.getCommentWithPicPermission,i=e.commentWithPicPermission,s=e.currentUser,c=this.state.current;"bottom"!==t||n||(this.loadByPagination(c),this.commentsWithPaginationEl&&this.setState({packupButtonLeft:this.commentsWithPaginationEl.getBoundingClientRect().right-16})),!a.length&&o(),void 0===i.commentWithPic&&s&&r()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,a=t.status,o=t.targetComment,r=t.commentPattern;n===e.order&&a===e.status||("bottom"===r?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!o&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentWillUnmount",value:function(){Object($.d)($.b),this.subscription&&this.subscription.unsubscribe()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.comments,o=t.commentPattern,r=t.commentInputPosition,i=t.isAuthor,s=t.parent,c=s.author,l=(c=void 0===c?{isOrg:!1}:c).isOrg,m=s.commentPermission,u=s.reviewingCounts,d=s.commentCount,h=s.adminClosedComment,f=t.totals,v=t.status,b=t.order,g=t.onStatusChange,y=t.onOrderChange,E=t.targetLink,k=t.shouldReverse,O=t.permission.canBrandAdminEdit,w="censor"===m&&(i||O),N=w?{isCommentReviewer:w,onStatusChange:g,status:v,reviewingCounts:u}:{status:v};return p.a.createElement("div",{className:C()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===o},n),ref:function(t){e.commentsElement=t}},p.a.createElement(Oe.a,Object.assign({commentCount:void 0!==d?d:f,shouldReverse:k,commentClosed:h,targetLink:E,order:b,onOrderChange:y,commentPattern:o,isOrg:l},N)),"top"===r&&this.renderCommentEdit(),"bottom"===o?this.renderPatternContent(a):this.renderModalContent(a),"bottom"===r&&this.renderCommentEdit())}}]),t}(d.Component),tt.propTypes={type:f.a.string,parent:f.a.object.isRequired,targetLink:f.a.node,commentNeedsReview:f.a.bool,byComment:f.a.oneOfType([f.a.number,f.a.string]),commentPattern:f.a.string,commentInputPosition:f.a.oneOf(["top","bottom"]),showPackupButton:f.a.bool,handlePackupButton:f.a.func,onPaginationClick:f.a.func,autoFocus:f.a.bool,shouldReverse:f.a.bool},tt.contextTypes={authRequired:f.a.func.isRequired},tt.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0,shouldReverse:!0},et=nt))||et;var ot,rt,it,st=n(132),ct=n.n(st),lt=n(175),mt=n.n(lt),ut=n(34),dt=n(2082),pt=Object(v.connect)(function(e,t){var n=t.conversationId,a=t.isAnchorComments,o=e.entities.comments,r=e.commentsV2,i=r.conversation,s=r.conversationMore,c=i[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},l=c.isFetching,m=c.isDrained,u=c.isPrevDrained,d=c.ids,p=c.totals,h=c.topComments,f=(h=void 0===h?{}:h).paging,v=(f||{}).isEnd,b=s[n]||{isFetching:!1,isDrained:!1,ids:[]},C=b.isFetching,g=b.isDrained,y=b.ids,E=y.map(function(e){return o[e]}),k=d.map(function(e){return o[e]}),O=o["".concat(n,"_featured")]||o[n]||{},w=a?mt()(y.length?[].concat(Object(R.a)(k.slice(0,4)),Object(R.a)(E),Object(R.a)(k.slice(4))):k,"id"):[O].concat(Object(R.a)(k)),N=f?[].concat(Object(R.a)(k.slice(0,3)),Object(R.a)(E)).length:-1;return{isFetching:l,isDrained:m,isPrevDrained:u,totals:p,comments:w,openComment:O,topCommentsPaging:f,isConversationMoreFetching:C,isConversationMoreDrained:v||g,offsetIndex:N}},{loadConversation:g.g,addComment:g.a,loadMoreAnchorComments:g.h})((it=rt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).load=function(){var e=n.props,t=e.isAnchorComments,a=e.conversationId;(0,e.loadConversation)({id:a,isAnchorComments:t})},n.addComment=function(e,t,a){var o=a.rootCommentId,r=a.isConversation,i=n.props,s=i.parent,c=s.type,l=s.id,m=i.conversationId,u=i.addComment,d=i.isAnchorComments;return u({parentType:c,parentId:l,content:e,replyTo:t,conversationId:m,rootCommentId:o,isConversation:r,replyType:Xe({id:o,replyTo:t,isConversation:r}).type,isAnchorComments:d})},n.loadMoreAnchorComments=function(){var e=n.props,t=e.conversationId,a=e.topCommentsPaging,o=void 0===a?{}:a;(0,e.loadMoreAnchorComments)({conversationId:t,nextUrl:o.next})},n.createOnRef=ct()(function(e){return function(t){var a=n.props.byComment;parseInt(e)===Number(a)&&(n.targetCommentEl=t)}}),n.scrollToTarget=function(){var e=Object(T.a)(n),t=e.targetCommentEl,a=e.listEl;if(a&&t){var o=t.getBoundingClientRect(),r=o.top,i=o.height,s=a.getBoundingClientRect(),c=s.top,l=s.height;n.listEl.scrollTop+=r-c-(l-i)/2,t.classList.add("CommentItemV2--highlighted"),setTimeout(function(){return t.classList.remove("CommentItemV2--highlighted")},2e3),t.tabIndex=-1,t.focus()}},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,a=t.onItemDelete,o=t.onItemFeature,r=t.onItemApprove,i=t.onItemCollapse,s=t.onItemDislike,c=t.onNavBack,l=t.canOperateItem,m=t.isFetching,u=t.comments,h=void 0===u?[]:u,f=t.commentNeedsReview,v=t.openComment.collapsed,b=t.parent,C=t.commentPattern,g=t.totals,y=t.isDrained,E=t.isPrevDrained,k=t.isConversationMoreFetching,O=t.isConversationMoreDrained,w=t.offsetIndex,I=null;return m&&!h.length?I=p.a.createElement(d.Fragment,null,p.a.createElement(N.a,{className:"CommentItemV2",small:!0}),p.a.createElement("div",{className:"CommentsV2-openComment-divider"}),p.a.createElement("div",{className:"CommentsV2-replyNum"},"".concat(g," 条回复"))):h.length&&(I=h.map(function(t,c){return c?O||c!==w||k?k&&c===w?p.a.createElement(d.Fragment,{key:t.id},p.a.createElement(Ue,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:f,canOperate:l,parent:b,comment:t,onLike:n,onDelete:a,onFeature:o,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:v,onReply:e.addComment}),p.a.createElement(N.a,{key:"NestCoomment-moreCommentButton-PlaceHolder",className:"NestCoomment-moreCommentButton ",small:!0})):p.a.createElement(Ue,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:f,canOperate:l,parent:b,comment:t,onLike:n,onDelete:a,onFeature:o,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:v,onReply:e.addComment}):p.a.createElement(d.Fragment,{key:t.id},p.a.createElement(Ue,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:f,canOperate:l,parent:b,comment:t,onLike:n,onDelete:a,onFeature:o,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:v,onReply:e.addComment}),p.a.createElement("div",{key:"NestCoomment-moreCommentButton",preset:"plain",className:"NestCoomment-moreCommentButton",onClick:e.loadMoreAnchorComments},p.a.createElement(dt.a,null),p.a.createElement("p",null,"点击查看更多回复"))):p.a.createElement(d.Fragment,{key:t.id},p.a.createElement("div",{className:"CommentsV2-openComment"},p.a.createElement(Ue,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:f,canOperate:l,parent:b,comment:t,onLike:n,onDelete:a,onFeature:o,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:v,onReply:e.addComment})),p.a.createElement("div",{className:"CommentsV2-openComment-divider"}),p.a.createElement("div",{key:"".concat(t.id,"-title")},p.a.createElement("div",{className:"CommentsV2-replyNum"},"".concat(g," 条回复"))))})),"bottom"===C?p.a.createElement(ut.b,{size:"fullPage",onClose:c},p.a.createElement("div",{className:"CommentsV2"},p.a.createElement(Oe.a,{isConversation:!0,commentPattern:C}),p.a.createElement(N.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:m,isDrained:y,isPrevDrained:E,onLoad:this.load,placeholder:p.a.createElement(N.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},I))):p.a.createElement("div",{className:"CommentsV2"},p.a.createElement(Oe.a,{isConversation:!0,onNavBack:c}),p.a.createElement(N.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:m,isDrained:y,isPrevDrained:E,onLoad:this.load,placeholder:p.a.createElement(N.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},I))}}]),t}(d.Component),rt.propTypes={conversationId:f.a.number.isRequired,type:f.a.string,parent:f.a.object.isRequired,commentNeedsReview:f.a.bool},rt.contextTypes={currentUser:f.a.object,authRequired:f.a.func.isRequired},ot=it))||ot;var ht,ft,vt,bt=n(61);n.d(t,"default",function(){return Ct});var Ct=Object(v.connect)(null,{updateCommentLikeStatus:g.o,updateCommentFeatureStatus:g.n,deleteComment:g.d,updateCommentCollapsed:g.l,updateCommentDisliked:g.m,approveComment:g.b,rejectComment:g.k})(ht=Object(bt.a)(null)((vt=ft=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={openedCommentId:null,isAnchorComments:!1,status:"open",order:"normal"},n.showConversation=function(e){var t=e.commentId,a=e.isAnchorComments;n.setState({openedCommentId:t,isAnchorComments:a})},n.showComments=function(){n.setState({openedCommentId:null,isAnchorComments:!1})},n.delete=function(e){var t=n.props,a=t.parent;return(0,t.deleteComment)(e,a.type,a.id)},n.feature=function(e){var t=n.props,a=t.parent,o=t.updateCommentFeatureStatus,r=t.notificationId;o({id:n.state.openedCommentId,commentId:e,parentId:a.id,parentType:a.type,notificationId:r})},n.like=function(e,t){var a=n.props,o=a.onItemLike,r=a.updateCommentLikeStatus;o&&o(e,t),r(e)},n.collapse=function(e){var t=n.props,a=t.parent;(0,t.updateCommentCollapsed)(e,a.type,a.id)},n.dislike=function(e){(0,n.props.updateCommentDisliked)(e)},n.approve=function(e){var t=n.props,a=t.parent,o=t.type;(0,t.approveComment)(e,a.type||o,a.id)},n.reject=function(e){var t=n.props,a=t.parent,o=t.type;(0,t.rejectComment)(e,a.type||o,a.id)},n.handleStatusChange=function(e){n.setState({status:e})},n.handleOrderChange=function(e,t){var a=n.props.onOrderChange;a&&a(e,t),n.setState({order:e})},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.parent,a=t.commentPattern,o=t.type,r=t.parent,s=(r=void 0===r?{}:r).commentPermission,c=r.relationship,l=void 0===c?{}:c,m=r.author,u=void 0===m?{}:m,d=t.needLoadCommentPermission,h=t.byComment,f=Object(i.a)(t,["parent","commentPattern","type","parent","needLoadCommentPermission","byComment"]),v=this.context.currentUser,b=void 0===l.isAuthor?v&&u.urlToken&&v.urlToken===u.urlToken:l.isAuthor,g="censor"===s&&!b,y="answer"===o||"article"===o,E=this.state,k=E.openedCommentId,O=E.status,w=E.order,N=E.isAnchorComments,I=N&&(k||h)||h;return p.a.createElement("div",{className:"Comments-container",ref:function(t){return e.commentsContainerNode=t}},p.a.createElement(at,Object.assign({className:C()({"CommentsV2--hidden":k&&"bottom"!==a})},f,{type:o,order:w,status:O,parent:n,commentPattern:a,commentNeedsReview:g,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,byComment:I,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:d,isAuthor:b})),k&&p.a.createElement(pt,Object.assign({},f,{parent:n,type:o,canOperateItem:y,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,commentPattern:a,conversationId:k,onNavBack:this.showComments,byComment:I,isAnchorComments:N,commentNeedsReview:g,onShowConversation:this.showConversation})))}}]),t}(d.Component),ft.propTypes={type:f.a.string.isRequired,parent:f.a.object.isRequired,onOrderChange:f.a.func,onItemLike:f.a.func,isAuthor:f.a.bool,onMount:f.a.func},ft.defaultProps={type:"answer"},ft.contextTypes={currentUser:f.a.object,authRequired:f.a.func.isRequired},ht=vt))||ht)||ht},2383:function(e,t,n){"use strict";n.r(t);var a=n(31),o=n(3),r=n(2),i=n(6),s=n(4),c=n(5),l=n(1),m=n.n(l),u=n(0),d=n.n(u),p=n(9),h=(n(348),n(42)),f=n(12),v=n(34),b=n(24),C=n(58),g=n(520),y=function(e,t,n){return n&&void 0!==t&&(e||!t)},E=20,k=60,O=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(i.a)(this,Object(s.a)(t).call(this))).shouldSubmitIsDisabled=function(){var t=e.state,n=t.title,a=t.description;return!n||n.length>E||a.length>k},e.state={isPublic:!0,title:"",description:""},e.handleSubmit=e.handleSubmit.bind(Object(b.a)(e)),e}return Object(c.a)(t,e),Object(r.a)(t,[{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.isPublic,a=t.title,o=t.description;if(a){var r=this.props,i=r.onSubmit,s=r.onBack,c=r.authRequired,l=r.isActive,m={title:a,description:o,isPublic:n};y(n,l,c)?c(i)(m):(i(m),s())}}},{key:"render",value:function(){var e=this,t=this.state,n=t.title,a=t.description,o=t.isPublic,r=this.props.onBack,i=this.shouldSubmitIsDisabled();return d.a.createElement("form",{className:"Favlists-content",onSubmit:this.handleSubmit},d.a.createElement("div",{className:"Favlists-addItems"},d.a.createElement("div",{className:"Favlists-addItem"},d.a.createElement(C.a,{className:"Favlists-titleInput",placeholder:"收藏标题",onChange:function(t){var n=t.target.value;e.setState({title:n})}}),d.a.createElement("div",{className:"Favlists-inputTips"},d.a.createElement(g.a,{name:"收藏标题",current:n?n.length:0,max:E}))),d.a.createElement("div",{className:"Favlists-addItem"},d.a.createElement(C.a,{multiline:!0,className:"Favlists-descritionInput",placeholder:"收藏描述（可选）",onChange:function(t){var n=t.target.value;e.setState({description:n})},rows:5}),d.a.createElement("div",{className:"Favlists-inputTips"},d.a.createElement(g.a,{name:"收藏描述",current:a?a.length:0,max:k}))),d.a.createElement("div",{className:"Favlists-addItem"},d.a.createElement("label",{className:"Favlists-privacyOption"},d.a.createElement("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"true",checked:o,onChange:function(){return e.setState({isPublic:!0})}}),d.a.createElement("span",null,"公开"),d.a.createElement("span",{className:"Favlists-privacyOptionTips"},"有其他人关注此收藏夹时不可设置为私密")),d.a.createElement("label",{className:"Favlists-privacyOption"},d.a.createElement("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"false",checked:!o,onChange:function(){return e.setState({isPublic:!1})}}),d.a.createElement("span",null,"私密"),d.a.createElement("span",{className:"Favlists-privacyOptionTips"},"只有你自己可以查看这个收藏夹")))),d.a.createElement(h.a,{direction:"horizontal",className:""},r&&d.a.createElement(p.c,{onClick:r},"返回"),d.a.createElement(p.c,{color:"blue",preset:"primary",type:"submit",disabled:i},"确认创建")))}}]),t}(u.Component);O.propTypes={onSubmit:m.a.func.isRequired,onBack:m.a.func,authRequired:m.a.func};var w=O,N=n(59),I=n(153),j=n(11),S=function(e){return d.a.createElement(j.a,e,d.a.createElement("path",{d:"M18 8c.1-3.308-2.592-6-5.9-6-3.308 0-6 2.692-6 6v2H5.002C4 10 4 11 4 11v9s0 2 2 2h12c2 0 2-1.97 2-1.97V11s0-1-1-1h-1V8zm-6-4c2.143.018 4.005 1.597 4 4v2H8V7.996C8.013 5.562 9.857 3.982 12 4z",fillRule:"evenodd"}))};S.defaultProps={name:"Lock"};var P=S,R=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).handleChange=function(){var e=n.props;(0,e.onChange)(e.id,n.props.checked)},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.zaEnabled,n=e.id;t&&f.default.setModule(this,{module:"CollectionItem"},{card:{card_type:"Content",content:{type:"Collection",token:String(n)}}})}},{key:"render",value:function(){var e=this.props,t=e.answerCount,n=e.title,a=e.isPublic,o=e.checked,r=void 0!==o&&o?{preset:"primary",color:"grey",children:"已收藏"}:{color:"blue",children:"收藏"};return d.a.createElement("div",{className:"Favlists-item"},d.a.createElement("div",{className:"Favlists-itemInner"},d.a.createElement("div",{className:"Favlists-itemName"},d.a.createElement("span",{className:"Favlists-itemNameText"},n),!1===a&&d.a.createElement("span",{className:"Favlists-itemIcon"},d.a.createElement(P,{size:16}))),d.a.createElement("div",{className:"Favlists-itemContent"},t," 条内容")),d.a.createElement(p.c,Object.assign({},r,{className:"Favlists-updateButton",onClick:this.handleChange})))}}]),t}(u.Component),T=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).items={},n.handleFavlistItemChange=function(e,t){f.default.trackEvent(n.items[e],{action:t?"UnCollect":"Collect",element:"Button",is_intent:!1}),n.props.onUpdate(e,t)},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.relations,a=t.items,o=t.isFetching,r=t.isDrained,i=t.onAdd,s=t.onLoad;return d.a.createElement("div",{className:"Favlists-content"},d.a.createElement(N.b,{isLocal:!0,isLoading:o,isDrained:r,onLoad:s,placeholder:d.a.createElement(I.a,{title:!0}),getContainer:function(e){return e},className:"Favlists-items"},a.map(function(t){return d.a.createElement(R,Object.assign({key:t.id,onChange:e.handleFavlistItemChange,checked:n[t.id]},t,{ref:function(n){e.items[t.id]=n}}))})),!a.length&&o||d.a.createElement("div",{className:"Favlists-actions"},d.a.createElement(p.c,{className:"Favlists-addButton",onClick:i,preset:"primary",color:"blue"},"创建收藏夹")))}}]),t}(u.Component);T.propTypes={isFecthing:m.a.bool,relations:m.a.object,onUpdate:m.a.func.isRequired,onAdd:m.a.func.isRequired,onLoad:m.a.func.isRequired,items:m.a.array.isRequired,isDrained:m.a.bool,authRequired:m.a.func};var L=T,D=n(2137),M=n(2138),x=(n(2215),n(2216),{list:{title:"添加收藏",tips:function(e){return e?"请选择你想添加的收藏夹":"你可以创建多个收藏夹，将答案分类收藏"}},add:{title:"创建新收藏夹"}}),A=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={status:n.props.defaultStatus},n.handleCloseModal=function(){n.props.onClose&&n.props.onClose(),n.setState({status:"list"})},n.handleUpdate=function(e,t){var a=n.props,o=a.onUpdateFav,r=a.id,i=a.type,s=a.items,c=a.authRequired,l=a.isUserActive,m=s.find(function(t){return t.id===e})||{},u=[e,r,i,m.isPublic];return!t&&y(m.isPublic,l,c)?c(o).apply(void 0,u):o.apply(void 0,u)},n.handleAdd=function(){return n.setState({status:"add"})},n.handleBack=function(){return n.setState({status:"list"})},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.shown,a=t.items,o=t.id,r=t.type,i=t.onFetchRelations,s=e.items,c=e.relations;if(i&&(s.length!==a.length&&e.shown||s.length&&!n&&e.shown)){var l=(c?s.filter(function(e){return!{}.hasOwnProperty.call(c,e.id)}):s).map(function(e){return e.id});l.length&&i(o,r,l)}s.length>a.length&&this.setState({status:"list"})}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.id,a=t.type,o=t.shown,r=t.zaEnabled;o&&!e.shown&&this.container&&r&&f.default.setModule(this.container,{module:"CollectionDialogue"},{card:{card_type:"Content",content:{type:Object(M.a)(a),token:String(n)}}})}},{key:"render",value:function(){var e,t=this,n=this.state.status,o=x[n],r=o.title,i=o.tips,s=this.props,c=s.shown,l=s.defaultStatus,m=s.relations,u=s.onFavlistAdd,f=s.onLoad,b=s.isFetching,C=s.isDrained,g=s.items,y=s.zaEnabled,E=s.authRequired,k=s.isUserActive,O=Object(a.a)(s,["shown","defaultStatus","relations","onFavlistAdd","onLoad","isFetching","isDrained","items","zaEnabled","authRequired","isUserActive"]),N=!(C&&!g.length),I=Object(D.a)(O,Object.keys(v.b.propTypes)).selectedProps;return e="list"===n?N?d.a.createElement(L,{ref:function(e){t.container=e},items:g,isFetching:b,isDrained:C,relations:m,onAdd:this.handleAdd,onUpdate:this.handleUpdate,onLoad:f,zaEnabled:y}):d.a.createElement(h.a,null,d.a.createElement(p.c,{preset:"primary",color:"blue",onClick:this.handleAdd},"创建收藏夹"),d.a.createElement(p.c,{onClick:this.handleCloseModal},"取消")):d.a.createElement(w,{onSubmit:u,isActive:k,onBack:"add"===l?this.handleCloseModal:this.handleBack,authRequired:E}),d.a.createElement(v.b,Object.assign({},I,{onClose:this.handleCloseModal,title:r,subtitle:i&&i(N),buttonGroupOnly:!N,className:"FavlistsModal",size:"large"}),c&&e)}}]),t}(u.Component);A.propTypes={id:m.a.oneOfType([m.a.string,m.a.number]),type:m.a.oneOf(["answer","article","pin"]),relations:m.a.object,onUpdateFav:m.a.func.isRequired,onFavlistAdd:m.a.func.isRequired,onFetchRelations:m.a.func,onClose:m.a.func.isRequired,shown:m.a.bool,zaEnabled:m.a.bool,authRequired:m.a.func,isUserActive:m.a.number},A.defaultProps={defaultStatus:"list",relations:{},authRequired:function(e){return e}};var B=A;n.d(t,"FavlistsModal",function(){return B})},2385:function(e,t,n){"use strict";n.r(t);var a=n(3),o=n(2),r=n(6),i=n(4),s=n(5),c=n(0),l=n.n(c),m=n(1),u=n.n(m),d=n(8),p=n.n(d),h=n(9),f=n(42),v=n(793),b=n(83),C=n(44),g=n(24),y=(n(2373),8),E=9,k=13,O=48,w=57;function N(e,t){return e?t?!0===t?"":t:e:""}var I=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).onInputFocus=n.onInputFocus.bind(Object(g.a)(n)),n.onInputChange=n.onInputChange.bind(Object(g.a)(n)),n.onKeyDown=n.onKeyDown.bind(Object(g.a)(n)),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"onInputFocus",value:function(){this.props.onFocus()}},{key:"onInputChange",value:function(e){var t=String(e.target.value);if(t){t=t[t.length-1];var n=this.props.chars,a=this.props.length;n.length===a?n=n.replace(/.$/,t):n+=t,this.props.onChange(n),n.length===a&&this.props.onFinish(n)}}},{key:"onKeyDown",value:function(e){var t=e.keyCode;if(!e.metaKey&&!e.ctrlKey&&t!==E&&t!==k){var n=this.props.chars;t===y?(n=n.slice(0,-1),this.props.onChange(n)):(t<O||t>w)&&(e.preventDefault(),this.props.onError(e))}}},{key:"focus",value:function(){this.input.focus()}},{key:"blur",value:function(){this.input.blur()}},{key:"render",value:function(){var e=this,t=this.props,n=t.length,a=t.chars,o=t.maskChar,r=t.autoFocus,i=t.className,s=t.children,c=a.length===n?n-1:a.length,m=a[c]||"";return l.a.createElement("label",{className:p()("TPass",i)},l.a.createElement("span",{className:"TPass-wrapper"},l.a.createElement(j,{length:n,chars:a,maskChar:o}),l.a.createElement("input",{className:"TPass-input",value:m,style:{left:60*c},onFocus:this.onInputFocus,onChange:this.onInputChange,onKeyDown:this.onKeyDown,onPaste:function(e){return e.preventDefault()},type:"number",min:"0",max:"9",pattern:"[0-9]*",autoFocus:r,ref:function(t){e.input=t}})),s)}}]),t}(l.a.Component);function j(e){for(var t,n=e.length,a=e.chars,o=e.maskChar,r=[],i=0;i<n;i+=1)t=a[i],r.push(l.a.createElement("span",{className:p()("TPassBox",{"TPassBox-mask":t&&Boolean(o)}),key:i},N(t,o)));return l.a.createElement("span",{className:"TPassBoxes"},r)}I.defaultProps={length:6,chars:"",maskChar:!1,autoFocus:!1,onFocus:function(){},onChange:function(){},onError:function(){},onFinish:function(){}},I.propTypes={length:u.a.number,chars:u.a.string,maskChar:u.a.oneOfType([u.a.bool,u.a.string]),autoFocus:u.a.bool,onFocus:u.a.func,onChange:u.a.func,onError:u.a.func,onFinish:u.a.func,className:u.a.string,children:u.a.node};var S=I,P=(n(2374),function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props;return l.a.createElement("div",{className:p()("Spinner",e)},l.a.createElement("i",{className:"Spinner-loading"}))}}]),t}(c.Component));P.propTypes={className:u.a.string};var R=n(125),T=(n(2375),11);function L(){this.payments={},this.chosePaymentName=null,this.codeUrl="",this.qrLoaded=!1,this.need=null,this.passcode="",this.needSMS=!1,this.smsTimer=0,this.isInProgress=!1,this.error=null}var D=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).onPasscodeFocus=function(){n.state.error&&(n.setState({error:null}),6===n.state.passcode.length&&n.setState({passcode:""}))},n.onPasscodeInput=function(e){"object"==typeof e&&(e=e.target.value),n.setState({passcode:e})},n.onPasscodeFinish=function(e){n.tpass.blur(),n.payWithBalance(e)},n.onSendSMSCode=function(){n.props.trade.resendSMSCode(function(){n.startSMSTimer(),n.smsInput.focus()},function(e){n.setState({error:e})})},n.onQrLoad=function(){n.setState({qrLoaded:!0})},n.onBalanceFormSubmit=function(e){e.preventDefault(),n.payWithBalance(n.state.passcode)},n.setPayments=function(e){n.setState({payments:e})},n.confirmPayment=function(){var e=n.state,t=e.choseName,a=e.payments,o=n.props.onConfirmPayment,r=t;if(t||(r=a.balance&&a.balance.enable?"balance":"wechat"),o(!r),n.setState({chosePaymentName:r}),"wechat"===r&&n.isInWechat){var i=n.props.tradeNumber,s="".concat(location.protocol,"//").concat(location.host).concat(location.pathname),c="".concat("https://www.zhihu.com/pay/weixin/pay?service_id=".concat(T)+"&trade_number=".concat(i,"&redirect_uri=").concat(encodeURIComponent(s)));window.location.replace(c)}else n.props.trade["wechat"===r?"initWechatPay":"initBalancePay"]()},n.pid=0,n.smsTimer=null,n.state=new L,n.isInWechat=e.ua.Wechat,n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.trade;this.getPaymentsList(e),this.initListeners(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.trade!==this.props.trade&&(this.setState(new L),setTimeout(function(){t.getPaymentsList(e.trade)},300),this.initListeners(e.trade))}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.smsTimer),this.props.trade.dispose()}},{key:"getPaymentsList",value:function(e){var t=this;if(e){var n=this.pid+=1;e.getPaymentsList(function(e){t.pid===n&&t.setPayments(e)})}}},{key:"initListeners",value:function(e){var t=this;e&&e.on("payInited",function(e,n){t.setState(Object.assign({},n))}).on("paySuccess",function(){t.setState({isInProgress:!1,error:null}),t.props.onSuccess()}).on("payCancel",function(){t.setState({isInProgress:!1,chosePaymentName:null})}).on("payFail",function(e){var n=e;"object"!=typeof e||e instanceof Error||(n=e.message),t.setState({isInProgress:!1,error:n}),t.props.onFail(e)}).on("needSMS",function(e){t.setState({isInProgress:!1,error:null,needSMS:e.message,passcode:""})}).on("needWechatCode",function(){t.props.onError("needWechatCode")}).on("error",function(e,n){t.props.onError(e,n)})}},{key:"startSMSTimer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;window.clearInterval(this.smsTimer),this.setState({smsTimer:t}),this.smsTimer=window.setInterval(function(){(t-=1)<=0?(window.clearInterval(e.smsTimer),e.smsTimer=null,e.setState({smsTimer:0})):e.setState({smsTimer:t})},1e3)}},{key:"payWithBalance",value:function(e){return 6!==e.length?(this.setState({error:"请输入 6 位支付密码"}),!1):(this.setState({isInProgress:!0,error:null}),this.props.trade.payWithBalance(e))}},{key:"renderPaymentsList",value:function(){var e=this,t=this.state,n=t.payments,a=t.chosePaymentName,o=t.choseName,r=this.props.trade;if(a)return null;var i=n.balance&&n.balance.amount,s=r.info.total,c=n.wechat&&n.wechat.enable,m=n.balance&&n.balance.enable,u=n.balance&&!n.balance.enable,d=i>=s?"使用余额（剩余 ".concat((i/100).toFixed(2),"）"):"微信支付",p=i>=s?"wallet":"wechatPayment",f="PaymentItem-".concat(i>=s?"wallet":"wechatPayment");o&&(d="wechat"===o?"微信支付":"使用余额（剩余 ".concat((i/100).toFixed(2),"）"),p="wechat"===o?"wechatPayment":"wallet",f="PaymentItem-".concat("wechat"===o?"wechatPayment":"wallet"));var v=l.a.createElement("div",null,l.a.createElement(C.a,{name:p,className:f}),l.a.createElement(h.c,{className:"Payment-Popover"},d),l.a.createElement(C.a,{className:"Select-arrow",name:"select"}));return l.a.createElement("div",{className:"PaymentsList"},l.a.createElement("span",{className:"Payment-Topline"}),l.a.createElement("span",{className:"PaymentWay"},"支付方式"),l.a.createElement(R.a,{placeholder:v},l.a.createElement(b.b,{plain:!0,className:"Payment-select",listClassName:"Payment-select-list",targetClassName:"Popover-targetContainer-verification",text:i>=s?"使用余额（剩余 ".concat((i/100).toFixed(2),"）"):"微信支付",menuToggler:v,onChange:function(t){"disabled"!==t&&e.setState({choseName:t})}},m&&l.a.createElement(b.a,{value:"balance",className:"PaymentItem"},l.a.createElement(C.a,{name:"wallet",className:"PaymentItem-wallet"}),"使用余额（剩余 ".concat((i/100).toFixed(2),"）")),u&&l.a.createElement(b.a,{value:"disabled",className:"PaymentItem PaymentItem--disabled"},l.a.createElement(C.a,{name:"wallet",className:"PaymentItem-wallet"}),"使用余额（剩余 ".concat((i/100).toFixed(2),"）")),c&&l.a.createElement(b.a,{value:"wechat",className:"PaymentItem"},l.a.createElement(C.a,{name:"wechatPayment",className:"PaymentItem-wechatPayment"}),"微信支付"))),l.a.createElement("span",{className:"Payment-Bottomline"}),l.a.createElement(h.c,{className:"Payment-CheckedButton",onClick:this.confirmPayment},"确认支付"))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.trade,o=this.state,r=o.payments,i=o.chosePaymentName,s=o.codeUrl,c=o.needSMS,m=o.isInProgress;return a?l.a.createElement("div",{className:p()("Payment",n)},Object.keys(r).length?this.renderPaymentsList():l.a.createElement("div",{className:"Payment-placeholder"},l.a.createElement(P,null)),"wechat"===i&&l.a.createElement("div",{className:"Payment-wechatPay"},l.a.createElement("div",{className:"Payment-wechatPayTitle"},l.a.createElement("i",{className:"icon icon-ic_wechatpay PaymentIconWechat"}),"微信支付"),!this.isInWechat&&l.a.createElement("div",null,"使用微信扫描二维码完成支付"),this.state.qrLoaded?l.a.createElement("span",{className:"Payment-qrWrapper"},l.a.createElement("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url=".concat(s),width:"150",height:"150"})):l.a.createElement("div",{className:"Payment-qrPlaceholder"},l.a.createElement(P,null),!this.isInWechat&&l.a.createElement("div",null,"正在生成二维码"),s&&l.a.createElement("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url=".concat(s),width:"1",height:"1",onLoad:this.onQrLoad}))),"balance"===i&&l.a.createElement("form",{onSubmit:this.onBalanceFormSubmit,className:"Payment-balancePay"},l.a.createElement("div",{className:"Payment-balancePayTitle"},l.a.createElement("i",{className:"icon icon-wallet PaymentIconWallet"}),"余额支付"),!c&&l.a.createElement("div",null,l.a.createElement("div",{className:"Payment-description"},"请输入 6 位数知乎支付密码，用于支付验证。"),l.a.createElement(S,{chars:this.state.passcode,onFocus:this.onPasscodeFocus,onChange:this.onPasscodeInput,maskChar:!0,onFinish:this.onPasscodeFinish,className:p()("Payment-tpass",{"Payment-errorInput":this.state.error,"Payment-progressing":m}),autoFocus:!0,ref:function(t){e.tpass=t}},m&&l.a.createElement(P,{className:"Payment-balancePaySpinner"}))),Boolean(c)&&l.a.createElement("div",{className:"Payment-balancePaySms"},l.a.createElement("div",{className:"Payment-balancePaySmsText"},String(c)),l.a.createElement("input",{onChange:this.onPasscodeInput,value:this.state.passcode,className:p()("Payment-sms","SimpleInput",{"Payment-errorInput":this.state.error}),type:"text",pattern:"\\d{6}",minLength:"6",maxLength:"6",title:"验证码应为 6 位数字",placeholder:"输入 6 位数验证码",required:!0,autoFocus:!0,ref:function(t){e.smsInput=t}}),this.state.smsTimer?l.a.createElement("button",{className:"Payment-sendSms",type:"button",disabled:!0},this.state.smsTimer," 秒后可重发"):l.a.createElement("button",{onClick:this.onSendSMSCode,className:"Payment-sendSms",type:"button"},"发送验证码")),l.a.createElement("div",{className:"Payment-balancePayFooter"},l.a.createElement("p",{className:"Payment-errorTip",style:{visibility:this.state.error?"visible":"hidden"}},this.state.error),Boolean(c)&&l.a.createElement(h.c,{color:"blue",disabled:m,className:"Payment-balancePayConfirmBtn",type:"submit"},"确认")),!c&&l.a.createElement("div",{className:"Payment-balancePayForget"},"如果忘记密码请邮件联系"," ",l.a.createElement("email",{className:"Payment-email"},"i@zhihu.com")))):l.a.createElement("div",{className:p()("Payment",n)},l.a.createElement("div",{className:"Payment-placeholder Payment-placehoder--empty"},l.a.createElement(P,null)))}}]),t}(l.a.Component);D.propTypes={trade:u.a.object,autoChooseSinglePayment:u.a.bool,onSuccess:u.a.func.isRequired,onFail:u.a.func,onError:u.a.func,onConfirmPayment:u.a.func},D.defaultProps={trade:null,onSuccess:function(){},onFail:function(){},onError:function(){},autoChooseSinglePayment:!0,className:""};var M=D,x=n(215),A="",B=null;var F=n(15);n(2376);n.d(t,"TipjarDialog",function(){return z});var _=[200,500,1e3,5e3,1e4,2e4],q=100,z=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).lockScroll=function(){document.body.classList.add("scroll-locked"),n.scrollTop=window.scrollY,document.body.style.width="100%",document.body.style.position="fixed",document.body.style.top=-n.scrollTop+"px"},n.unlockScroll=function(){document.body.classList.remove("scroll-locked"),document.body.style.width=null,document.body.style.position=null,void 0!==n.scrollTop&&(window.scrollTo(0,n.scrollTop),n.scrollTop=void 0),document.body.style.top=null},n.onConfirmPayment=function(e){n.setState({chosePaymentName:e})},n.onPaySuccess=function(){n.props.onPaySuccess(),n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:"",customButton:!1})},n.handleCustomAmount=function(){n.state.trade&&n.state.trade.dispose(),n.setState({showCustom:!0})},n.handleCustomChange=function(e){var t=e.target.value;isNaN(t)?n.setState({customAmount:""}):n.setState({customAmount:parseInt(t)||""})},n.handleCustomKeyUp=function(e){13===e.keyCode&&n.handleSubmitCustom()},n.handleSubmitCustom=function(){var e=n.state.customAmount*q;e>0&&e<=5e4&&(n.setState({customButton:!0,showCustom:!1,colseTijarDialogStatus:!1}),n.createTrade(e))},n.closeModal=function(){n.state.trade&&n.state.trade.dispose(),n.setState(n.getDefaultState())},n.handleAmountButton=function(e){n.createTrade(e.currentTarget.dataset.amount),n.setState({colseTijarDialogStatus:!1,customButton:!1,showCustom:!1})},n.createTrade=function(e){n.setState({tradeLoading:!0,currentAmount:e});var t=n.props.ua;n.props.addReward(e,t.Wechat?"wechat":"normal"),n.setState({tradeLoading:!1})},n.colseTijarDialog=function(){n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:""}),n.props.colseTijarDialog()},n.state=n.getDefaultState(),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.showTip()}},{key:"componentDidUpdate",value:function(e){var t=e.TipjarRender,n=this.props,a=n.tradeNumber,o=n.type,r=n.isMobile,i=n.TipjarRender,s=this.state,c=s.trade,l=s.colseTijarDialogStatus,m="article"===o?11:17;if(a&&(!c||a!==c.tradeNo)&&!l){var u=new window.zhihu.pay.Trade(a,m);this.setState({trade:u})}r&&(!t&&i?this.lockScroll():t&&!i&&this.unlockScroll())}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.TipjarRender,n=e.isMobile;t&&this.props.removeTradeNumber(),t&&n&&this.unlockScroll()}},{key:"getDefaultState",value:function(){return{showCustom:!1,customAmount:"",currentAmount:"",showTipModal:!1,customButton:!1,chosePaymentName:!0,colseTijarDialogStatus:!1}}},{key:"showTip",value:function(){var e,t,n=this;e="https://pay.zhihu.com/api/js",t=function(){n.setState({showTipModal:!0})},A&&e&&e!==A&&t(new Error("A pay-sdk from different source has been load")),A=e,window.zhihu&&window.zhihu.pay?window.zhihu.pay.ready(t):(B||(B=Object(x.loadScript)(e)),B.then(function(){return window.zhihu.pay.ready(t)},function(e){t(e),B=null}))}},{key:"renderAmountCustom",value:function(){var e=this.state,t=e.showCustom,n=e.customAmount,a=e.currentAmount,o=e.customButton;return l.a.createElement("div",{className:"Reward-TipjarDialog-amountCustom"},t?l.a.createElement("div",{className:"Reward-TipjarDialog-amountInput"},l.a.createElement("input",{name:"",type:"text",className:"SimpleInput",placeholder:"你想赞赏的金额（不超过 500）",value:n,onChange:this.handleCustomChange,onKeyUp:this.handleCustomKeyUp,ref:function(e){e&&e.focus()}}),l.a.createElement(h.c,{disabled:n<=0||n>500,color:"blue",preset:"primary",onClick:this.handleSubmitCustom},"确定"),l.a.createElement("div",{className:"Reward-TipjarDialog-error",style:{display:n>500?"block":"none"}},"不能超过 500 元")):l.a.createElement(h.c,{preset:"plain",className:o?"TipjarDialog-customButton-cheked":"TipjarDialog-customButton",onClick:this.handleCustomAmount},o?"自定义金额： ￥ ".concat(a/q):"自定义金额"))}},{key:"renderTipjarDialog",value:function(){var e=this,t=this.props,n=t.author,a=n.name,o=n.avatarUrl,r=n.isOrg,i=n.urlToken,s=n.id,c=t.tagline,m=this.state.currentAmount;return l.a.createElement("div",{className:"Reward-TipjarDialog"},l.a.createElement("div",{className:"Reward-TipjarDialog-user"},l.a.createElement("a",{href:"/".concat(r?"org":"people","/").concat(i||s),className:"Reward-UserAvatar"},l.a.createElement("img",{src:o.replace("_is","_l"),className:"Reward-Avatar",alt:"当前用户"})),a),l.a.createElement("div",{className:"Reward-TipjarDialog-tagLine"},c),l.a.createElement("div",{className:"Reward-TipjarDialog-selectAmount"},l.a.createElement("div",{className:"Reward-TipjarDialog-amountList"},_.map(function(t){return l.a.createElement(h.c,{key:t,"data-amount":t,onClick:e.handleAmountButton,color:"red",className:p()({"Reward-Button-checked":Number(m)===t})},l.a.createElement("b",null,Number(m)===t?"".concat(t/q," 元"):"￥ ".concat(t/q)))})),this.renderAmountCustom()))}},{key:"render",value:function(){var e=this.props,t=e.ua,n=e.TipjarRender,a=e.isMobile,o=e.tradeNumber,r=this.state,i=r.showCustom,s=r.tradeLoading,c=r.showTipModal,m=r.trade,u=r.chosePaymentName,d=a?v.a:f.b,p=a?"small":"default";return l.a.createElement(d,{overlay:!0,size:p,onClose:this.colseTijarDialog,className:"Reward-TipjarDialogModal"},n&&l.a.createElement("div",null,c&&u&&this.renderTipjarDialog(),(m||s)&&!i&&l.a.createElement(M,{trade:m,tradeNumber:o,ua:t,onSuccess:this.onPaySuccess,onConfirmPayment:this.onConfirmPayment})))}}]),t}(c.Component);z.propTypes={author:u.a.object,tagline:u.a.string,colseTijarDialog:u.a.func,addReward:u.a.func,tradeNumber:u.a.number,removeTradeNumber:u.a.func,onPaySuccess:u.a.func,isMobile:u.a.bool,type:u.a.string},z.defaultProps={tagline:F.i}},2387:function(e,t,n){"use strict";n.r(t);var a=n(31),o=n(3),r=n(2),i=n(6),s=n(4),c=n(5),l=n(1),m=n.n(l),u=n(0),d=n.n(u),p=n(13),h=n(8),f=n.n(h),v=n(108),b=n(24),C=n(2132),g=n(12),y=n(73),E=n(132),k=n.n(E),O=n(2084),w=n(2378),N=n(107),I=n(59),j=n(2172),S=n(9),P=n(40),R=n(134),T=n(21),L=n(65),D=n(109),M=n(335),x=n(522),A=n(521),B=n(2136),F=n(513);n(2204);function _(e,t){switch(e){case"answer":return Object(L.c)(t);case"article":return Object(D.b)(t);default:return null}}var q=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(i.a)(this,Object(s.a)(t).call(this,e,n))).state={collapsed:!0,current:1,packupButtonStatus:!1,packupButtonLeft:0},a.handleOpenCollapsed=function(){a.setState({collapsed:!1}),a.load(a.props,!1,!0)},a.createOnRef=k()(function(e){return function(t){var n=a.props.byComment;e===Number(n)&&(a.targetCommentEl=t)}}),a.handlePageSelect=function(e){var t=a.props.onPaginationClick,n=a.state.current;t&&t(n,e),a.commentsElement.scrollIntoView(),a.setState({current:e}),a.loadByPagination(e)},a.renderComment=function(e){var t=a.props,n=t.parent,o=n.type,r=n.author,i=(r=void 0===r?{isOrg:!1}:r).isOrg,s=t.isMobile,c=t.parent,l=t.commentNeedsReview,m=t.onShowConversation,u=t.status,p=t.onItemLike,h=t.onItemDelete,f=t.onItemCollapse,v=t.onItemDislike,b=t.onItemApprove,C=t.canOperateItem,g=t.commentPattern;return d.a.createElement(A.a,{key:e.id,isMobile:s,comment:e,onRef:a.createOnRef(e.id),status:u,type:o,parent:c,canOperate:C,commentNeedsReview:l,onShowConversation:m,ownerAuthorIsOrg:i,onLike:p,onReply:a.addComment,onFeature:a.featureItem,onDelete:h,onCollapse:f,onDislike:v,onApprove:b,commentPattern:g})},a.renderNormalComments=function(e){var t=a.state.collapsed,n=a.props.byComment,o=[];if(a.lastFeaturedIndex=0,e.length>0){var r=e[0].featured,i=!1;e.forEach(function(s,c){if(n||!s.collapsed){var l=e[c-1];if(!s.collapsed||(l&&l.collapsed||o.push(a.renderCollapsedDivider()),!t)){o.push(a.renderComment(s));var m=e[c+1];r&&!i&&s.featured&&(!m||!m.featured)&&(i=!0,a.lastFeaturedIndex=c,o.push(d.a.createElement("div",{className:"CommentList-divider",key:"divider-featured"},d.a.createElement("div",{className:"CommentList-dividerLine"}),d.a.createElement("div",{className:"CommentList-dividerText"},"以上为精选评论",d.a.createElement(O.a,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})))))}}})}return o},a.renderCollapsedComments=function(){var e=[],t=a.props.collapsedComments;return a.state.collapsed||!t||t.length<=0?[]:(e.push(t.map(function(e){return a.renderComment(e)})),e)},a.renderComments=function(e){return e.map(a.renderComment)},a.renderBottomButton=function(){var e=a.props.params,t=e.id,n=e.answerId,o=Boolean(n);return d.a.createElement("div",{className:"Comments-footer CommentEditor--normal"},d.a.createElement(S.c,{className:"CommentEditor-startCommentButton",preset:"primary",color:"blue",onClick:function(){return Object(N.b)(Object(R.a)(o?{type:"answer",id:n}:{type:"question",id:t},{utm_content:"comment_area"}),{zaProps:{id:3906}})}},"打开 App 参与站内讨论"))},a.load=a.load.bind(Object(b.a)(a)),a.loadByPagination=a.loadByPagination.bind(Object(b.a)(a)),a.addComment=a.addComment.bind(Object(b.a)(a)),a.featureItem=a.featureItem.bind(Object(b.a)(a)),a.handleScroll=a.handleScroll.bind(Object(b.a)(a)),a}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.subscription=Object(y.subscribe)("scroll",this.handleScroll);var e=this.props,t=e.byComment,n=e.commentPattern,a=e.parent.adminClosedComment,o=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||a||(this.loadByPagination(o),this.commentsWithPaginationEl&&this.setState({packupButtonLeft:this.commentsWithPaginationEl.getBoundingClientRect().right-16}))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,a=t.status,o=t.targetComment,r=t.commentPattern;n===e.order&&a===e.status||("bottom"===r?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!o&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(T.d)(T.b)),this.subscription&&this.subscription.unsubscribe()}},{key:"load",value:function(e,t,n){if(!this.props.isFetching&&!this.props.parent.adminClosedComment){var a=e||this.props,o=a.order,r=a.byComment,i=a.status,s=a.parent,c=s.id,l=s.type,m=a.dispatch,u=a.commentPattern;if(a.needLoadCommentPermission&&_(l,c)&&m(_(l,c)),n){m(Object(v.e)(l,c,{order:o,isPrevious:t,byComment:r,status:"collapsed",commentPattern:u},!0))}else m(Object(v.e)(l,c,{order:o,isPrevious:t,byComment:r,status:i,commentPattern:u}))}}},{key:"addComment",value:function(e,t){var n=this.props,a=n.parent,o=a.id,r=a.type,i=n.dispatch,s=[r,o,e];return t&&(s[3]=t.id),i(v.a.apply(void 0,s))}},{key:"featureItem",value:function(e){this.props.onItemFeature(e,this.lastFeaturedIndex)}},{key:"handleScroll",value:function(){if(this.commentsElement&&this.commentsWithPaginationEl){var e=window.innerHeight,t=this.state.packupButtonStatus,n=this.commentsWithPaginationEl.getBoundingClientRect(),a=n.top,o=n.bottom,r=n.height;!t&&r>500&&o>e&&a<0?this.setState({packupButtonStatus:!0}):t&&(r<=500||o<=e||a>=0)&&this.setState({packupButtonStatus:!1})}}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),a=n.top,o=n.height,r=t.getBoundingClientRect(),i=r.top,s=r.height;this.listEl.scrollTop+=a-i-(s-o)/2,e.classList.add("CommentItem--highlighted"),setTimeout(function(){return e.classList.remove("CommentItem--highlighted")},2e3),e.tabIndex=-1,e.focus()}}},{key:"loadByPagination",value:function(e,t){var n=t||this.props,a=n.order,o=n.byComment,r=n.status,i=n.parent,s=i.id,c=i.type,l=n.dispatch,m=n.commentPattern;n.needLoadCommentPermission&&_(c,s)&&l(_(c,s)),l(Object(v.e)(c,s,{order:a,isPrevious:!1,byComment:o,status:r,commentPattern:m,current:e}))}},{key:"renderCollapsedDivider",value:function(){var e=this.props,t=e.isDrained,n=e.parent.collapsedCounts;return!t||n<=0?[]:this.state.collapsed?d.a.createElement("div",{className:"CommentList-action",key:"collapsed"},d.a.createElement("div",{className:"CommentList-expendCollapseButton"},d.a.createElement("span",{onClick:this.handleOpenCollapsed},Object(P.formatNumber)(n)," 条评论被折叠"),"（",d.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):d.a.createElement("div",{className:"CommentList-divider",key:"divider-collapsed"},d.a.createElement("div",{className:"CommentList-dividerLine"}),d.a.createElement("div",{className:"CommentList-dividerText"},Object(P.formatNumber)(n)," 条评论被折叠（",d.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))}},{key:"renderCollapsedInfiLoader",value:function(){var e=this,t=this.state.collapsed;if(t)return[];var n=this.props.collapsedInfo,a=(n=void 0===n?{}:n).isFetching,o=n.isPrevDrained,r=n.isDrained;return d.a.createElement(I.b,{className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:a,isPrevDrained:o,isDrained:r,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:d.a.createElement(I.a,{className:"CommentItem",small:!0})},this.renderCollapsedComments())}},{key:"renderPatternContent",value:function(e){var t=this,n=this.props,a=n.isFetching,o=n.parent.adminClosedComment,r=n.byComment,i=n.status,s=n.order,c=n.totals,l=n.showPackupButton,m=n.handlePackupButton,u=Math.ceil(c/20),p=this.state,h=p.current,f=p.packupButtonStatus,v=p.packupButtonLeft;return o?null:a?d.a.createElement(B.a,{onRef:function(e){t.commentsWithPaginationEl=e}}):d.a.createElement("div",{ref:function(e){t.commentsWithPaginationEl=e}},d.a.createElement("div",{className:"CommentList"},"normal"===s&&"open"===i?this.renderNormalComments(e):this.renderComments(e)),u>1&&d.a.createElement(j.a,{className:"comments-pagination",current:h,total:u,onSelect:this.handlePageSelect}),!r&&this.renderCollapsedDivider(),!r&&this.renderCollapsedInfiLoader(),d.a.createElement(C.CSSTransitionGroup,{transitionName:"Comments-Packup-Button",transitionEnterTimeout:300,transitionLeaveTimeout:300},l&&f&&d.a.createElement("button",{onClick:m,className:"Comments-Packup-Button",style:{left:v}},"收起评论",d.a.createElement(w.a,{center:!0}))))}},{key:"renderModalContent",value:function(e){var t=this,n=this.props,a=n.collapsedInfo,o=n.parent.adminClosedComment,r=n.status,i=n.order,s=n.byComment,c=this.state.collapsed,l=c?this.props:a,m=l.isFetching,u=l.isDrained,p=l.isPrevDrained;if(u&&e.length<=0||o)return d.a.createElement("div",{className:"Comments-empty"},d.a.createElement(M.a,{entityType:"comments"}));var h={getContainer:function(e){return e}};return d.a.createElement(I.b,Object.assign({className:"CommentList",onRef:function(e){t.listEl=e},isLocal:!0,isLoading:m,isPrevDrained:p,isDrained:u,onLoad:function(e){return t.load(t.props,e,!c)},placeholder:d.a.createElement(I.a,{className:"CommentItem",small:!0})},h),"normal"===i&&"open"===r?this.renderNormalComments(e):this.renderComments(e),!s&&this.renderCollapsedDivider(),!s&&this.renderCollapsedComments())}},{key:"renderCommentEdit",value:function(e){var t=this.props,n=t.parent,a=n.canComment,o=(a=void 0===a?{status:!0}:a).status,r=a.reason,i=n.author,s=(i=void 0===i?{isOrg:!1}:i).isOrg,c=n.type,l=n.id,m=n.adminClosedComment,u=n.questionType,p=t.byComment,h=t.autoFocus,v=t.commentNeedsReview,b=m?"当前内容暂时无法评论":r,C=h&&!p;return o&&!m?d.a.createElement(x.a,Object.assign({className:"Comments-".concat("top"===e?"top":"footer"),type:c,id:l,commentNeedsReview:v,onSubmit:this.addComment,autoFocus:C,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===u},"top"===e&&{preset:"default",onClick:function(e){g.default.trackEvent(e.target,{id:3905})}})):"top"!==e&&d.a.createElement("div",{className:f()("Comments-disabledText",{"Comments-disabledText--fixed":void 0})},d.a.createElement("div",{className:"Comments-disabledReason"},b))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.isAuthor,o=t.comments,r=t.commentPattern,i=t.commentInputPosition,s=t.parent,c=s.canComment,l=(c=void 0===c?{status:!0}:c).status,m=s.author,u=(m=void 0===m?{isOrg:!1}:m).isOrg,p=s.commentPermission,h=s.reviewingCounts,v=s.commentCount,b=s.adminClosedComment,C=t.totals,g=t.status,y=t.order,E=t.onStatusChange,k=t.onOrderChange,O=t.targetLink,w=o.filter(function(e){return!e.isDelete}),N="censor"===p&&a,I=N?{isCommentReviewer:N,onStatusChange:E,status:g,reviewingCounts:h}:{status:g},j=f()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===r},n);return d.a.createElement("div",{className:j,ref:function(t){e.commentsElement=t}},d.a.createElement(F.a,Object.assign({commentCount:void 0!==v?v:C,commentClosed:b,targetLink:O,order:y,onOrderChange:k,commentPattern:r,isOrg:u,options:this.renderCommentEdit("top")},I)),"top"===i&&this.renderCommentEdit(),"bottom"===r?this.renderPatternContent(w):this.renderModalContent(w),"bottom"===i&&!l&&this.renderCommentEdit(),"bottom"===i&&l&&this.renderBottomButton())}}]),t}(u.Component);q.propTypes={type:m.a.string,parent:m.a.object.isRequired,targetLink:m.a.node,commentNeedsReview:m.a.bool,byComment:m.a.oneOfType([m.a.number,m.a.string]),commentPattern:m.a.string,commentInputPosition:m.a.oneOf(["top","bottom"]),showPackupButton:m.a.bool,handlePackupButton:m.a.func,onPaginationClick:m.a.func,autoFocus:m.a.bool},q.contextTypes={authRequired:m.a.func.isRequired},q.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0};var z=Object(p.connect)(function(e,t){var n=t.parent,a=t.parent,o=a.type,r=a.id,i=t.status,s=t.order,c=t.byComment,l=t.commentPattern,m=e.entities,u=e.comments,d="".concat(o,"_").concat(r),p=u.parent,h=u.pagination;"reviewing"===i&&(h=u.reviewing),"reverse"===s&&"open"===i&&(h=u.reverse);var f=[],v=u.collapsed[d]||{};v.ids&&v.ids.length>0&&(f=v.ids.map(function(e){return m.comments[e]}));var b=h[d]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},C=b.isFetching,g=b.isPrevDrained,y=b.isDrained,E=b.ids,k=b.newIds,O=void 0===k?[]:k;return{isFetching:C,isPrevDrained:g,isDrained:y,totals:b.totals,comments:("bottom"!==l?E:O).map(function(e){return m.comments[e]}),collapsedInfo:v,collapsedComments:f,targetComment:m.comments[c],parent:Object.assign({},n,{},p[d])}})(q),V=n(34);var U=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(i.a)(this,Object(s.a)(t).call(this,e,n))).load=a.load.bind(Object(b.a)(a)),a.addComment=n.authRequired(a.addComment.bind(Object(b.a)(a)),void 0,T.b),a}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(v.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,a=n.parent,o=a.type,r=a.id,i=n.commentId,s=n.dispatch,c=[o,r,e,t.id,i];return s(v.a.apply(void 0,c))}},{key:"render",value:function(){var e,t,n,a=this.props,o=a.onItemLike,r=a.onItemDelete,i=a.onItemFeature,s=a.onItemApprove,c=a.onItemCollapse,l=a.onItemDislike,m=a.onNavBack,u=a.canOperateItem,p=a.isFetching,h=a.comments,f=a.commentNeedsReview,v=a.openComment.collapsed,b=a.parent,C=a.parent.canComment,g=(C=void 0===C?{status:!0}:C).status,y=C.reason,E=a.commentPattern,k=a.commentId,O=this.context.currentUser;return Boolean(O&&h.find(function(e){return e.author&&e.author.member.urlToken===O.urlToken}))&&(t=(e=h.filter(function(e){return e.author&&e.author.member.urlToken!==O.urlToken}))[e.length-1]),p&&!h.length?n=d.a.createElement(I.a,{className:"CommentItem",small:!0}):h.length&&(n=h.map(function(e,t){return d.a.createElement(A.a,{key:t,isConversation:!0,commentNeedsReview:f,canOperate:u,parent:b,comment:e,onLike:o,onDelete:r,onFeature:i,onApprove:s,onCollapse:c,onDislike:l,collapsedShown:v})})),"bottom"===E?d.a.createElement(V.b,{size:"fullPage",onClose:m},d.a.createElement("div",{className:"Comments"},d.a.createElement(F.a,{isConversation:!0,commentPattern:E}),d.a.createElement("div",{className:"CommentList"},n))):d.a.createElement("div",{className:"Comments"},d.a.createElement(F.a,{isConversation:!0,onNavBack:m}),d.a.createElement("div",{className:"CommentList"},n),t&&(g?d.a.createElement(x.a,{id:k,type:"conversation",className:"Comments-footer",replyTo:t,commentNeedsReview:f,onSubmit:this.addComment}):d.a.createElement("div",{className:"Comments-disabledText"},y)))}}]),t}(u.Component);U.propTypes={commentId:m.a.number.isRequired,type:m.a.string,parent:m.a.object.isRequired,commentNeedsReview:m.a.bool},U.contextTypes={currentUser:m.a.object,authRequired:m.a.func.isRequired};var W,H,K,G=Object(p.connect)(function(e,t){var n=t.commentId,a=e.entities.comments,o=e.comments.conversation[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:o.isFetching,isDrained:o.isDrained,comments:o.ids.map(function(e){return a[e]}),openComment:a[n]}})(U),Q=n(61),$=Object(Q.a)(null)((K=H=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(i.a)(this,Object(s.a)(t).call(this,e))).state={openedCommentId:null,status:"open",order:"normal"},n.like=function(e,t){var a=n.props,o=a.onItemLike,r=a.dispatch;o&&o(e,t),r(Object(v.j)(e))},n.collapse=function(e){var t=n.props,a=t.dispatch,o=t.parent;a(Object(v.g)(e,o.type,o.id))},n.dislike=function(e){return n.props.dispatch(Object(v.h)(e))},n.approve=function(e){var t=n.props,a=t.dispatch,o=t.parent,r=t.type;a(Object(v.b)(e,o.type||r,o.id))},n.handleStatusChange=function(e){n.setState({status:e})},n.handleOrderChange=function(e,t){n.props.onOrderChange&&n.props.onOrderChange(e,t),n.setState({order:e})};var a=e.parent,r=e.dispatch;return n.feature=function(e,t){return r(Object(v.i)(e,a.id,a.type,t))},n.delete=function(e){return r(Object(v.d)(e,a.type,a.id))},n.showConversation=function(e){return n.setState({openedCommentId:e})},n.showComments=function(){return n.setState({openedCommentId:null})},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.parent,o=t.commentPattern,r=t.type,i=t.parent,s=(i=void 0===i?{}:i).commentPermission,c=i.relationship,l=void 0===c?{}:c,m=i.author,u=void 0===m?{}:m,p=t.needLoadCommentPermission,h=Object(a.a)(t,["parent","commentPattern","type","parent","needLoadCommentPermission"]),v=this.context.currentUser,b=void 0===l.isAuthor?v&&u.urlToken&&v.urlToken===u.urlToken:l.isAuthor,C="censor"===s&&!b,g="answer"===r||"article"===r,y=this.state,E=y.openedCommentId,k=y.status,O=y.order,w={commentNeedsReview:C,parent:n,type:r,canOperateItem:g,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return d.a.createElement("div",{className:"Comments-container",ref:function(t){return e.domNode=t}},d.a.createElement(z,Object.assign({},h,w,{commentPattern:o,className:f()({"Comments--hidden":E&&"bottom"!==o}),order:O,status:k,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:p,isAuthor:b})),E&&d.a.createElement(G,Object.assign({},h,w,{commentPattern:o,commentId:E,onNavBack:this.showComments})))}}]),t}(u.Component),H.propTypes={type:m.a.string.isRequired,parent:m.a.object.isRequired,onOrderChange:m.a.func,onItemLike:m.a.func,isAuthor:m.a.bool,onMount:m.a.func},H.defaultProps={type:"answer"},H.contextTypes={currentUser:m.a.object,authRequired:m.a.func.isRequired},W=K))||W;t.default=Object(p.connect)()($)}}]);
//# sourceMappingURL=column.modals.2cdb63ca58235ddc3ce6.js.map